<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCæœåŠ¡å™¨çŠ¶æ€æŸ¥è¯¢å™¨</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
        }

        /* èƒŒæ™¯æ ·å¼ï¼ˆæš—é»‘ç§‘æŠ€é£ï¼‰ */
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #e0e0e0;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('bg.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.78; /* è°ƒæ•´ä¸é€æ˜åº¦ä¸º78% */
            z-index: -1;
        }

        /* ç«–å±æ—¶åˆ‡æ¢ä¸º 1.PNG */
        @media (max-aspect-ratio: 1/1) {
            body::before {
                background-image: url('1.PNG');
            }
        }

        /* å¤´éƒ¨æ ·å¼ */
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(25, 25, 45, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(168, 85, 247, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #a855f7, #3b82f6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        header p {
            color: #b0b0c0;
            font-size: 1.1rem;
        }

        /* ä¸»å†…å®¹å®¹å™¨ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            flex: 1;
        }

        /* å¡ç‰‡é€šç”¨æ ·å¼ */
        .card {
            background: rgba(25, 25, 45, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(168, 85, 247, 0.3);
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        /* æŸ¥è¯¢é¢æ¿æ ·å¼ */
        .query-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label {
            font-size: 1.1rem;
            color: #d0d0e0;
        }

        input {
            padding: 12px 15px;
            background: rgba(15, 15, 30, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.5);
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input:focus {
            border-color: #a855f7;
            box-shadow: 0 0 10px rgba(168, 85, 247, 0.3);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        button {
            flex: 1;
            padding: 12px;
            background: linear-gradient(90deg, #a855f7, #3b82f6);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.3s ease, transform 0.2s ease;
        }

        button:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        button:active {
            transform: scale(0.98);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ç»“æœé¢æ¿æ ·å¼ */
        .result-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(15, 15, 30, 0.8);
            border-radius: 10px;
            border: 1px solid rgba(59, 130, 246, 0.5);
        }

        .status-item {
            text-align: center;
            flex: 1;
        }

        .status-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            transition: all 0.5s ease;
        }

        .status-label {
            font-size: 0.9rem;
            color: #b0b0c0;
            margin-bottom: 5px;
        }

        .status-subtext {
            font-size: 0.85rem;
            color: #a855f7;
            font-weight: 600;
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background: rgba(15, 15, 30, 0.8);
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 8px 8px 0 0;
            color: #b0b0c0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .tab-btn.active {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
            border-bottom: 1px solid transparent;
        }

        .tab-content {
            padding: 20px;
            background: rgba(15, 15, 30, 0.8);
            border-radius: 0 8px 8px 8px;
            border: 1px solid rgba(168, 85, 247, 0.3);
            min-height: 200px;
        }

        /* æœåŠ¡å™¨è¯¦æƒ…æ ·å¼ */
        .server-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .detail-item {
            padding: 15px;
            background: rgba(25, 25, 45, 0.7);
            border-radius: 8px;
            text-align: center;
            transition: transform 0.3s ease;
            position: relative;
        }

        .detail-item:hover {
            transform: scale(1.05);
        }

        .detail-label {
            font-size: 0.9rem;
            color: #b0b0c0;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #3b82f6;
            transition: all 0.5s ease;
        }

        .detail-value.online {
            color: #10b981;
        }

        .detail-value.offline {
            color: #ef4444;
        }

        /* å»¶è¿Ÿå’ŒAPIä¿¡æ¯æ ·å¼ */
        .ping-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.2rem;
            color: #a855f7;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(168, 85, 247, 0.3);
        }

        .ping-summary {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-item {
            padding: 15px;
            background: rgba(25, 25, 45, 0.7);
            border-radius: 8px;
            text-align: center;
        }

        .summary-label {
            font-size: 0.9rem;
            color: #b0b0c0;
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 1.4rem;
            font-weight: 700;
            transition: all 0.5s ease;
        }

        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }

        .api-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(25, 25, 45, 0.7);
            border-radius: 8px;
            transition: background-color 0.3s ease;
            opacity: 1;
            animation: fadeIn 0.5s ease forwards;
        }

        .api-item:hover {
            background: rgba(168, 85, 247, 0.1);
        }

        .api-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-name {
            font-weight: 600;
            color: #d0d0e0;
        }

        .api-region {
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .api-region.domestic {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .api-region.foreign {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        
        .api-region.custom {
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .status-indicator.online {
            background-color: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
        }

        .status-indicator.offline {
            background-color: #ef4444;
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
        }

        .status-indicator.error {
            background-color: #f59e0b;
            box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
        }

        .ping-value {
            font-weight: 600;
            min-width: 70px;
            text-align: right;
            transition: all 0.5s ease;
        }

        .ping-good {
            color: #10b981;
        }

        .ping-medium {
            color: #f59e0b;
        }

        .ping-bad {
            color: #ef4444;
        }

        /* åœ¨çº¿ç©å®¶åˆ—è¡¨æ ·å¼ */
        .players-container {
            margin-top: 20px;
        }

        .players-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .players-count {
            font-size: 1.2rem;
            color: #a855f7;
            transition: all 0.5s ease;
        }

        .player-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .player-card {
            padding: 12px;
            background: rgba(25, 25, 45, 0.7);
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
            transform: translateY(5px);
        }

        .player-card:nth-child(1) { animation-delay: 0.05s; }
        .player-card:nth-child(2) { animation-delay: 0.1s; }
        .player-card:nth-child(3) { animation-delay: 0.15s; }
        .player-card:nth-child(4) { animation-delay: 0.2s; }
        .player-card:nth-child(5) { animation-delay: 0.25s; }
        .player-card:nth-child(6) { animation-delay: 0.3s; }
        .player-card:nth-child(7) { animation-delay: 0.35s; }
        .player-card:nth-child(8) { animation-delay: 0.4s; }
        .player-card:nth-child(9) { animation-delay: 0.45s; }
        .player-card:nth-child(10) { animation-delay: 0.5s; }

        .player-card:hover {
            transform: translateY(-5px);
            background: rgba(168, 85, 247, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .player-name {
            font-weight: 600;
            color: #e0e0e0;
            word-break: break-word;
            font-size: 0.95rem;
        }

        .no-players {
            text-align: center;
            padding: 30px;
            color: #b0b0c0;
            font-size: 1.1rem;
        }

        /* å†å²è®°å½•æ ·å¼ */
        .history-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            padding: 8px 10px;
            background: rgba(15, 15, 30, 0.8);
            border-radius: 5px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .history-item:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        /* è‡ªåŠ¨åˆ·æ–°çŠ¶æ€æŒ‡ç¤ºå™¨ - å·²æ›´æ–° */
        .auto-refresh-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(25, 25, 45, 0.7);
            border-radius: 8px;
            margin-top: 10px;
        }

        .refresh-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #10b981;
            animation: pulse 2s infinite;
        }

        .refresh-indicator.inactive {
            background-color: #ef4444;
            animation: none;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .status-bar {
                flex-direction: column;
                gap: 15px;
            }

            .btn-group {
                flex-direction: column;
            }
            
            .api-grid {
                grid-template-columns: 1fr;
            }
            
            .ping-summary {
                grid-template-columns: 1fr;
            }
            
            .player-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .card {
                padding: 15px;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1 1 auto;
                text-align: center;
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            
            .server-details-grid {
                grid-template-columns: 1fr;
            }
            
            .player-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* éšè—å…ƒç´  */
        .hidden {
            display: none !important;
        }
        
        /* æœåŠ¡å™¨å›¾æ ‡æ ·å¼ */
        .server-icon-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .server-icon {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid rgba(168, 85, 247, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .no-icon {
            width: 120px;
            height: 120px;
            border-radius: 8px;
            background: linear-gradient(135deg, #a855f7, #3b82f6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            border: 2px solid rgba(168, 85, 247, 0.5);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            transition: all 0.5s ease;
        }
        
        /* æœåŠ¡å™¨å¤´åƒæ ·å¼ï¼ˆç»Ÿä¸€ä¸º120pxï¼‰ */
        .server-avatar-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .server-avatar {
            width: 120px; /* ç»Ÿä¸€ä¸º120px */
            height: 120px; /* ç»Ÿä¸€ä¸º120px */
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid rgba(168, 85, 247, 0.7);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: transform 0.5s ease, opacity 0.5s ease;
        }
        
        .server-avatar:hover {
            transform: scale(1.05);
        }
        
        /* æœåŠ¡å™¨åç§°æ ·å¼ï¼ˆä¸å¤´åƒå¹¶æ’ï¼Œå·¦å¯¹é½ï¼‰ */
        .server-name-container {
            display: flex;
            align-items: center;
            margin-left: 10px; /* å¤´åƒä¸åå­—ä¹‹é—´çš„é—´è· */
            flex: 1;
            justify-content: flex-start; /* å·¦å¯¹é½ */
        }
        
        .server-name {
            font-size: 1.6rem;
            font-weight: 700;
            color: #a855f7;
            text-align: left; /* å·¦å¯¹é½ */
            max-width: 100%;
            word-break: break-word;
            padding: 8px 15px;
            background: rgba(168, 85, 247, 0.15);
            border-radius: 8px;
            border: 2px solid rgba(168, 85, 247, 0.4);
            line-height: 1.3;
            display: inline-block;
            white-space: nowrap; /* ä¿æŒæ¨ªç€æ‘†æ”¾ */
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.5s ease;
        }
        
        /* APIçŠ¶æ€åˆ†ç»„æ ‡é¢˜ */
        .api-group-title {
            font-size: 1.1rem;
            color: #a855f7;
            margin: 20px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(168, 85, 247, 0.3);
        }
        
        /* èŠ‚ç‚¹ç»Ÿè®¡ */
        .node-stats {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(25, 25, 45, 0.7);
            border-radius: 8px;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        
        .node-stat-item {
            text-align: center;
            flex: 1;
            min-width: 100px;
        }
        
        .node-stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #3b82f6;
            transition: all 0.5s ease;
        }
        
        .node-stat-label {
            font-size: 0.85rem;
            color: #b0b0c0;
            margin-top: 5px;
        }
        
        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-container {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid rgba(168, 85, 247, 0.2);
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .progress-title {
            font-size: 1.1rem;
            color: #a855f7;
            font-weight: 600;
        }
        
        .progress-percentage {
            font-size: 1rem;
            font-weight: 700;
            color: #3b82f6;
            transition: all 0.5s ease;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(15, 15, 30, 0.8);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            border-radius: 10px;
            width: 0%;
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #b0b0c0;
        }
        
        .progress-info span {
            font-weight: 600;
            transition: all 0.5s ease;
        }
        
        .progress-info .current {
            color: #10b981;
        }
        
        .progress-info .max {
            color: #a855f7;
        }
        
        /* æœåŠ¡å™¨è¯¦æƒ…é¡µå¸ƒå±€è°ƒæ•´ï¼ˆå¤´åƒå’Œåå­—å¹¶æ’ï¼Œæ¨ªç€æ‘†æ”¾ï¼Œåå­—å·¦å¯¹é½ï¼‰ */
        .server-details-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(168, 85, 247, 0.2);
            transition: all 0.5s ease;
        }
        
        /* æ–°çš„å¤´åƒå’Œåå­—å¹¶æ’å¸ƒå±€ */
        .server-avatar-name-row {
            display: flex;
            align-items: center;
            width: 100%;
            justify-content: flex-start; /* ç¡®ä¿æ•´ä¸ªè¡Œå·¦å¯¹é½ */
        }
        
        /* åº•éƒ¨ç‰ˆæƒä¿¡æ¯æ æ ·å¼ */
        .footer-bar {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            background: rgba(25, 25, 45, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            border: 1px solid rgba(168, 85, 247, 0.2);
            color: #b0b0c0;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .footer-bar a {
            color: #a855f7;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-bar a:hover {
            color: #3b82f6;
            text-decoration: underline;
        }
        
        .footer-bar .copyright {
            font-weight: 600;
            color: #a855f7;
            margin-bottom: 5px;
        }
        
        .footer-bar .disclaimer {
            font-size: 0.85rem;
            color: #9090a0;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* è°ƒæ•´æ•´ä½“å¸ƒå±€ï¼Œç¡®ä¿åº•éƒ¨æ åœ¨é¡µé¢æœ€åº•éƒ¨ */
        .content-wrapper {
            flex: 1;
            width: 100%;
        }
        
        /* éƒ¨åˆ†ç©å®¶è­¦å‘Šæ ·å¼ */
        .partial-warning {
            padding: 10px 15px;
            margin-bottom: 15px;
            background: rgba(245, 158, 11, 0.15);
            border-radius: 8px;
            border: 1px solid rgba(245, 158, 11, 0.3);
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
        }
        
        .partial-warning-title {
            color: #f59e0b;
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .partial-warning-content {
            font-size: 0.9rem;
            color: #e0e0e0;
            line-height: 1.4;
        }
        
        /* è‡ªå®šä¹‰APIç®¡ç†æ ·å¼ - å¯æŠ˜å  */
        .custom-api-panel {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid rgba(168, 85, 247, 0.3);
        }
        
        .custom-api-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px 15px;
            background: rgba(25, 25, 45, 0.7);
            border-radius: 8px;
            border: 1px solid rgba(168, 85, 247, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .custom-api-header:hover {
            background: rgba(168, 85, 247, 0.1);
            transform: translateY(-2px);
        }
        
        .custom-api-title {
            font-size: 1.2rem;
            color: #a855f7;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .custom-api-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(15, 15, 30, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        
        .custom-api-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: rgba(25, 25, 45, 0.7);
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid rgba(168, 85, 247, 0.2);
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
        }
        
        .custom-api-info {
            display: flex;
            flex-direction: column;
            gap: 3px;
            flex: 1;
            overflow: hidden;
        }
        
        .custom-api-name {
            font-weight: 600;
            color: #d0d0e0;
            font-size: 0.95rem;
        }
        
        .custom-api-url {
            font-size: 0.8rem;
            color: #b0b0c0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .custom-api-actions {
            display: flex;
            gap: 5px;
        }
        
        .api-action-btn {
            padding: 4px 8px;
            font-size: 0.75rem;
            background: rgba(168, 85, 247, 0.3);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        
        .api-action-btn:hover {
            opacity: 0.8;
        }
        
        .api-action-btn.delete {
            background: rgba(239, 68, 68, 0.7);
        }
        
        .api-action-btn.enable {
            background: rgba(16, 185, 129, 0.7);
        }
        
        .api-action-btn.disable {
            background: rgba(245, 158, 11, 0.7);
        }
        
        .no-custom-apis {
            text-align: center;
            padding: 20px;
            color: #b0b0c0;
            font-style: italic;
        }
        
        /* APIæ·»åŠ è¡¨å•æ ·å¼ */
        .api-form {
            background: rgba(25, 25, 45, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(168, 85, 247, 0.2);
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
        }
        
        .form-title {
            font-size: 1rem;
            color: #a855f7;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        /* APIæ ¼å¼æç¤º */
        .api-format-hint {
            font-size: 0.85rem;
            color: #b0b0c0;
            margin-top: 5px;
            line-height: 1.4;
        }
        
        .api-format-hint code {
            background: rgba(168, 85, 247, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
            color: #a855f7;
        }
        
        /* è‡ªå®šä¹‰APIç»Ÿè®¡ */
        .custom-api-stats {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 8px 12px;
            background: rgba(25, 25, 45, 0.7);
            border-radius: 6px;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }
        
        .stats-label {
            font-size: 0.9rem;
            color: #b0b0c0;
        }
        
        .stats-value {
            font-weight: 600;
            color: #a855f7;
            transition: all 0.5s ease;
        }
        
        /* æŠ˜å å†…å®¹ */
        .custom-api-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
            margin-top: 0;
        }
        
        .custom-api-content.expanded {
            max-height: 1000px;
            margin-top: 15px;
        }
        
        /* æŠ˜å å›¾æ ‡ */
        .collapse-icon {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
            color: #a855f7;
        }
        
        .collapse-icon.expanded {
            transform: rotate(180deg);
        }
        
        /* å›½å†…/å›½å¤–APIçŠ¶æ€å¯æŠ˜å é¢æ¿ */
        .api-group-panel {
            margin-bottom: 20px;
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 8px;
            overflow: hidden;
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
        }
        
        .api-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(25, 25, 45, 0.7);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .api-group-header:hover {
            background: rgba(168, 85, 247, 0.1);
        }
        
        .api-group-title-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .api-group-title {
            font-size: 1.1rem;
            color: #a855f7;
            font-weight: 600;
        }
        
        .api-group-stats {
            font-size: 0.9rem;
            color: #b0b0c0;
            background: rgba(168, 85, 247, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            transition: all 0.5s ease;
        }
        
        .api-group-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
            background: rgba(15, 15, 30, 0.5);
        }
        
        .api-group-content.expanded {
            max-height: 1000px;
            padding: 15px;
        }
        
        /* è¿è¡Œæ—¶é—´ä¸“ç”¨æ ·å¼ */
        .uptime-value {
            color: #10b981;
            font-weight: 700;
            transition: all 0.5s ease;
        }
        
        /* æ— æ„Ÿåˆ·æ–°åŠ¨ç”» */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* å¹³æ»‘è¿‡æ¸¡åŠ¨ç”» */
        .smooth-update {
            transition: all 0.5s ease;
        }
        
        /* æ•°å€¼å˜åŒ–åŠ¨ç”» */
        .value-change {
            animation: pulseValue 0.5s ease;
        }
        
        @keyframes pulseValue {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* åˆ·æ–°æŒ‡ç¤ºå™¨åŠ¨ç”» */
        .refreshing {
            animation: refreshingPulse 1s infinite;
        }
        
        @keyframes refreshingPulse {
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0.5; transform: scale(1); }
        }
        
        /* å›¾æ ‡ä¼˜åŒ– */
        .icon-emoji {
            font-size: 1.2em;
            margin-right: 5px;
        }
        
        /* çŠ¶æ€å›¾æ ‡ */
        .status-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 6px;
            vertical-align: middle;
        }
        
        /* è‡ªå®šä¹‰å›¾æ ‡æ ·å¼ */
        .custom-icon {
            font-size: 1.1em;
            margin-right: 5px;
        }
        
        /* æ— æ„Ÿåˆ·æ–°é®ç½© */
        .refresh-mask {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(25, 25, 45, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .refresh-mask.active {
            opacity: 1;
        }
        
        /* åˆ·æ–°æ—¶é—´æ˜¾ç¤º */
        .refresh-time {
            font-size: 0.8rem;
            color: #b0b0c0;
            margin-left: auto;
            opacity: 0.7;
        }
        
        /* æœåŠ¡å™¨è¯¦æƒ…é¡¹çš„åŠ¨ç”»å»¶è¿Ÿ */
        .detail-item:nth-child(1) { animation-delay: 0.05s; }
        .detail-item:nth-child(2) { animation-delay: 0.1s; }
        .detail-item:nth-child(3) { animation-delay: 0.15s; }
        .detail-item:nth-child(4) { animation-delay: 0.2s; }
        .detail-item:nth-child(5) { animation-delay: 0.25s; }
        .detail-item:nth-child(6) { animation-delay: 0.3s; }
        .detail-item:nth-child(7) { animation-delay: 0.35s; }
        
        /* APIé¡¹çš„åŠ¨ç”»å»¶è¿Ÿ */
        .api-item:nth-child(1) { animation-delay: 0.05s; }
        .api-item:nth-child(2) { animation-delay: 0.1s; }
        .api-item:nth-child(3) { animation-delay: 0.15s; }
        .api-item:nth-child(4) { animation-delay: 0.2s; }
        .api-item:nth-child(5) { animation-delay: 0.25s; }
        .api-item:nth-child(6) { animation-delay: 0.3s; }
        .api-item:nth-child(7) { animation-delay: 0.35s; }
        .api-item:nth-child(8) { animation-delay: 0.4s; }
        .api-item:nth-child(9) { animation-delay: 0.45s; }
        .api-item:nth-child(10) { animation-delay: 0.5s; }
        
        /* è‡ªåŠ¨åˆ·æ–°å¼€å…³æ ·å¼ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(239, 68, 68, 0.7);
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: rgba(16, 185, 129, 0.7);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* è‡ªåŠ¨åˆ·æ–°çŠ¶æ€æ–‡æœ¬ */
        .refresh-status-text {
            flex: 1;
        }
        
        /* è‡ªåŠ¨åˆ·æ–°ç§’æ•°è®¾ç½®æ ·å¼ */
        .refresh-interval-container {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
        }
        
        .refresh-interval-input {
            width: 60px;
            padding: 4px 8px;
            background: rgba(15, 15, 30, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.5);
            border-radius: 4px;
            color: #e0e0e0;
            text-align: center;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        .refresh-interval-input:focus {
            border-color: #a855f7;
            box-shadow: 0 0 5px rgba(168, 85, 247, 0.3);
        }
        
        .refresh-interval-label {
            font-size: 0.85rem;
            color: #b0b0c0;
            white-space: nowrap;
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .auto-refresh-status {
                flex-wrap: wrap;
                gap: 12px;
            }
            
            .refresh-interval-container {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-left: 0;
            }
            
            .toggle-switch {
                margin-left: 0;
            }
            
            .refresh-status-text {
                min-width: 140px;
            }
        }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <header>
            <h1><span class="custom-icon">ğŸ®</span> MCæœåŠ¡å™¨çŠ¶æ€æŸ¥è¯¢å™¨</h1>
            <p>å®æ—¶æŸ¥è¯¢MinecraftæœåŠ¡å™¨çŠ¶æ€ã€ç©å®¶æ•°é‡ã€ç‰ˆæœ¬åŠå»¶è¿Ÿä¿¡æ¯ <span class="refresh-time" id="last-refresh-time"></span></p>
        </header>

        <div class="main-content">
            <!-- æŸ¥è¯¢é¢æ¿ -->
            <div class="query-panel card">
                <div class="input-group">
                    <label for="server-ip"><span class="icon-emoji">ğŸŒ</span> æœåŠ¡å™¨åœ°å€ (æ”¯æŒç«¯å£)</label>
                    <input type="text" id="server-ip" placeholder="ä¾‹å¦‚: play.example.com æˆ– play.example.com:25566" value="">
                </div>

                <div class="btn-group">
                    <button id="query-btn"><span class="icon-emoji">ğŸ”</span> æŸ¥è¯¢æœåŠ¡å™¨</button>
                    <button id="clear-btn"><span class="icon-emoji">ğŸ—‘ï¸</span> æ¸…é™¤åœ°å€</button>
                </div>

                <div class="auto-refresh-status">
                    <div class="refresh-indicator inactive" id="refresh-indicator"></div>
                    <span class="refresh-status-text" id="refresh-status">è‡ªåŠ¨åˆ·æ–°å·²åœæ­¢</span>
                    <div class="refresh-interval-container">
                        <span class="refresh-interval-label">åˆ·æ–°é—´éš”:</span>
                        <input type="number" id="refresh-interval" class="refresh-interval-input" min="1" max="60" value="5" title="è®¾ç½®è‡ªåŠ¨åˆ·æ–°é—´éš”(ç§’)">
                        <span class="refresh-interval-label">ç§’</span>
                    </div>
                    <label class="toggle-switch">
                        <!-- ä¿®æ”¹ç‚¹ï¼šç§»é™¤checkedå±æ€§ï¼Œé»˜è®¤å…³é—­ -->
                        <input type="checkbox" id="auto-refresh-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="history-panel">
                    <h3 style="margin-bottom: 15px; color: #3b82f6;"><span class="icon-emoji">ğŸ“š</span> æŸ¥è¯¢å†å²</h3>
                    <div class="history-list" id="history-list">
                        <div class="history-item">æš‚æ— æŸ¥è¯¢è®°å½•</div>
                    </div>
                    <button id="clear-history" style="margin-top: 10px; padding: 8px 12px; font-size: 0.9rem; background: rgba(239, 68, 68, 0.7);"><span class="icon-emoji">ğŸ§¹</span> æ¸…ç©ºå†å²è®°å½•</button>
                </div>
            </div>

            <!-- ç»“æœé¢æ¿ -->
            <div class="result-panel">
                <div class="status-bar">
                    <div class="status-item">
                        <div class="status-value" id="online-count">--</div>
                        <div class="status-label"><span class="icon-emoji">ğŸ‘¥</span> åœ¨çº¿ç©å®¶</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="max-count">--</div>
                        <div class="status-label"><span class="icon-emoji">ğŸ“Š</span> æœ€å¤§å®¹é‡</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="server-version">--</div>
                        <div class="status-label"><span class="icon-emoji">ğŸ”§</span> æœåŠ¡å™¨ç‰ˆæœ¬</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="avg-ping">--</div>
                        <div class="status-label"><span class="icon-emoji">âš¡</span> å›½å†…å¹³å‡å»¶è¿Ÿ</div>
                    </div>
                </div>

                <div class="card" id="result-card">
                    <!-- æ— æ„Ÿåˆ·æ–°é®ç½© -->
                    <div class="refresh-mask" id="refresh-mask">
                        <div class="loading"></div>
                    </div>
                    
                    <!-- æ ‡ç­¾é¡µé¡ºåºè°ƒæ•´ï¼šæœåŠ¡å™¨è¯¦æƒ… -> åœ¨çº¿ç©å®¶åˆ—è¡¨ -> å»¶è¿Ÿä¸APIçŠ¶æ€ -->
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="server-info"><span class="icon-emoji">ğŸ </span> æœåŠ¡å™¨è¯¦æƒ…</button>
                        <button class="tab-btn" data-tab="players-list"><span class="icon-emoji">ğŸ‘¤</span> åœ¨çº¿ç©å®¶åˆ—è¡¨</button>
                        <button class="tab-btn" data-tab="ping-api-info"><span class="icon-emoji">ğŸ“¡</span> å»¶è¿Ÿä¸APIçŠ¶æ€</button>
                    </div>

                    <div class="tab-content" id="server-info-tab">
                        <div id="server-info-content">
                            <p style="color: #b0b0c0; text-align: center; margin-top: 20px;"><span class="icon-emoji">ğŸ”</span> è¯·å…ˆæŸ¥è¯¢æœåŠ¡å™¨è·å–è¯¦æƒ…</p>
                        </div>
                    </div>

                    <div class="tab-content hidden" id="players-list-tab">
                        <div class="players-container">
                            <div class="players-header">
                                <h3 style="color: #a855f7;"><span class="icon-emoji">ğŸ‘¤</span> åœ¨çº¿ç©å®¶</h3>
                                <div class="players-count" id="players-count">0 ä½ç©å®¶</div>
                            </div>
                            <div id="players-content">
                                <p class="no-players"><span class="icon-emoji">ğŸ‘€</span> è¯·å…ˆæŸ¥è¯¢æœåŠ¡å™¨è·å–ç©å®¶ä¿¡æ¯</p>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content hidden" id="ping-api-info-tab">
                        <!-- å»¶è¿Ÿä¸APIçŠ¶æ€å†…å®¹ -->
                        <div id="ping-api-content">
                            <p style="color: #b0b0c0; text-align: center; margin-top: 20px;"><span class="icon-emoji">ğŸ“Š</span> è¯·å…ˆæŸ¥è¯¢æœåŠ¡å™¨è·å–å»¶è¿Ÿå’ŒAPIä¿¡æ¯</p>
                            <div id="ping-api-details" style="margin-top: 20px;"></div>
                        </div>
                        
                        <!-- è‡ªå®šä¹‰APIç®¡ç†æ¨¡å— - å¯æŠ˜å é¢æ¿ -->
                        <div id="custom-api-management" class="custom-api-panel">
                            <div class="custom-api-header" id="custom-api-header">
                                <div class="custom-api-title">
                                    <span><span class="icon-emoji">ğŸ”§</span> è‡ªå®šä¹‰APIç®¡ç†</span>
                                    <span class="custom-api-stats">
                                        <span class="stats-label">å·²å¯ç”¨:</span>
                                        <span class="stats-value" id="enabled-api-count">0</span>
                                        <span class="stats-label">æ€»æ•°:</span>
                                        <span class="stats-value" id="total-api-count">0</span>
                                    </span>
                                </div>
                                <div class="collapse-icon" id="custom-api-arrow">â–¼</div>
                            </div>
                            
                            <div class="custom-api-content" id="custom-api-content">
                                <div class="api-form">
                                    <div class="form-title"><span class="icon-emoji">â•</span> æ·»åŠ è‡ªå®šä¹‰API</div>
                                    <div class="input-group">
                                        <label for="custom-api-name">APIåç§°</label>
                                        <input type="text" id="custom-api-name" placeholder="ä¾‹å¦‚: æˆ‘çš„ç§äººAPI">
                                        <label for="custom-api-url">API URLæ¨¡æ¿</label>
                                        <input type="text" id="custom-api-url" placeholder="ä¾‹å¦‚: https://api.example.com/status?ip={address}&port={port}">
                                        <div class="api-format-hint">
                                            <span class="icon-emoji">ğŸ’¡</span> ä½¿ç”¨ <code>{address}</code> å’Œ <code>{port}</code> ä½œä¸ºå ä½ç¬¦ï¼Œæ”¯æŒæ ‡å‡†çš„MinecraftæœåŠ¡å™¨çŠ¶æ€APIæ ¼å¼ã€‚
                                        </div>
                                    </div>
                                    <button id="add-custom-api-btn" style="margin-top: 10px; width: 100%;"><span class="icon-emoji">â•</span> æ·»åŠ è‡ªå®šä¹‰API</button>
                                </div>
                                
                                <div class="custom-api-list" id="custom-api-list">
                                    <div class="no-custom-apis"><span class="icon-emoji">ğŸ“­</span> æš‚æ— è‡ªå®šä¹‰API</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ç‰ˆæƒä¿¡æ¯æ  -->
    <div class="footer-bar">
        <div class="copyright"><span class="icon-emoji">Â©ï¸</span> Minecraft æœåŠ¡å™¨æŸ¥è¯¢ç³»ç»Ÿ Â© 2026</div>
        <div class="disclaimer">
            <span class="icon-emoji">âš¡</span> æ•´åˆå¤šä¸ªAPIæŸ¥è¯¢ï¼Œæ”¯æŒæ— æ„Ÿåˆ·æ–°å’Œç«¯å£æ£€æµ‹ | æœ¬å·¥å…·ä»…ç”¨äºæŸ¥è¯¢æœåŠ¡å™¨å…¬å¼€ä¿¡æ¯ï¼Œè¯·éµå®ˆ Minecraft ä½¿ç”¨åè®®
        </div>
    </div>

    <script>
        // DOMå…ƒç´ 
        const ipInput = document.getElementById('server-ip');
        const queryBtn = document.getElementById('query-btn');
        const clearBtn = document.getElementById('clear-btn');
        const clearHistoryBtn = document.getElementById('clear-history');
        const historyListEl = document.getElementById('history-list');
        const refreshIndicator = document.getElementById('refresh-indicator');
        const refreshStatus = document.getElementById('refresh-status');
        const refreshMask = document.getElementById('refresh-mask');
        const lastRefreshTimeEl = document.getElementById('last-refresh-time');
        const autoRefreshToggle = document.getElementById('auto-refresh-toggle');
        const refreshIntervalInput = document.getElementById('refresh-interval');
        
        // è‡ªå®šä¹‰APIç›¸å…³DOMå…ƒç´ 
        const customApiHeader = document.getElementById('custom-api-header');
        const customApiArrow = document.getElementById('custom-api-arrow');
        const customApiContent = document.getElementById('custom-api-content');
        const customApiListEl = document.getElementById('custom-api-list');
        const enabledApiCountEl = document.getElementById('enabled-api-count');
        const totalApiCountEl = document.getElementById('total-api-count');
        const customApiNameInput = document.getElementById('custom-api-name');
        const customApiUrlInput = document.getElementById('custom-api-url');
        const addCustomApiBtn = document.getElementById('add-custom-api-btn');
        
        // çŠ¶æ€æ˜¾ç¤ºå…ƒç´ 
        const onlineCountEl = document.getElementById('online-count');
        const maxCountEl = document.getElementById('max-count');
        const serverVersionEl = document.getElementById('server-version');
        const avgPingEl = document.getElementById('avg-ping');
        
        // æ ‡ç­¾é¡µå…ƒç´ 
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // å†…å®¹å®¹å™¨
        const serverInfoContent = document.getElementById('server-info-content');
        const pingApiContent = document.getElementById('ping-api-content');
        const pingApiDetails = document.getElementById('ping-api-details');
        const playersContent = document.getElementById('players-content');
        const playersCountEl = document.getElementById('players-count');
        const resultCard = document.getElementById('result-card');
        
        // å¸¸é‡
        const HISTORY_KEY = 'mc_server_query_history';
        const CUSTOM_APIS_KEY = 'mc_custom_apis';
        const AUTO_REFRESH_TOGGLE_KEY = 'mc_auto_refresh_toggle';
        const REFRESH_INTERVAL_KEY = 'mc_refresh_interval';
        const MAX_HISTORY = 5;
        
        // å˜é‡
        let refreshInterval = null;
        let isRequesting = false;
        let currentAddress = '';
        let currentQueryAddress = '';
        let apiResults = [];
        let playersList = [];
        let avgPing = null; // å­˜å‚¨å¹³å‡å»¶è¿Ÿ
        let serverName = ''; // å­˜å‚¨æœåŠ¡å™¨åç§°
        let serverIcon = ''; // å­˜å‚¨æœåŠ¡å™¨å›¾æ ‡
        let customApis = []; // å­˜å‚¨è‡ªå®šä¹‰API
        let isCustomApiExpanded = false; // è‡ªå®šä¹‰APIé¢æ¿æ˜¯å¦å±•å¼€
        let isDomesticApiExpanded = false; // å›½å†…APIçŠ¶æ€æ˜¯å¦å±•å¼€
        let isForeignApiExpanded = false; // å›½å¤–APIçŠ¶æ€æ˜¯å¦å±•å¼€
        let lastRefreshTime = null; // ä¸Šæ¬¡åˆ·æ–°æ—¶é—´
        let isAutoRefreshEnabled = false; // è‡ªåŠ¨åˆ·æ–°æ˜¯å¦å¯ç”¨
        let refreshIntervalSeconds = 5; // é»˜è®¤åˆ·æ–°é—´éš”ä¸º5ç§’

        // ==================== å·¥å…·å‡½æ•° ====================
        // æ ¼å¼åŒ–è¿è¡Œæ—¶é—´ï¼ˆç§’è½¬å¯è¯»æ ¼å¼ï¼‰
        function formatUptime(seconds) {
            if (!seconds || seconds <= 0) return 'æœªçŸ¥';
            
            const days = Math.floor(seconds / (24 * 3600));
            const hours = Math.floor((seconds % (24 * 3600)) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (days > 0) {
                return `${days}å¤© ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ`;
            } else if (hours > 0) {
                return `${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ`;
            } else if (minutes > 0) {
                return `${minutes}åˆ†é’Ÿ ${secs}ç§’`;
            } else {
                return `${secs}ç§’`;
            }
        }

        // ç‰ˆæœ¬å·æå–å·¥å…·
        function extractVersionFromText(text) {
            if (!text) return null;
            const match = String(text).match(/\b\d+\.\d+(\.\d+)?\b/);
            return match ? match[0] : null;
        }

        // æ¸…ç†Minecrafté¢œè‰²ä»£ç 
        function cleanMinecraftText(text) {
            return String(text || '').replace(/Â§[0-9a-fk-or]/gi, '').replace(/\$[0-9a-fk-or]/gi, '').trim() || 'æœªçŸ¥';
        }

        function formatPlayerCount(count) {
            return !isNaN(Number(count)) ? Number(count) : 0;
        }

        // æ›´æ–°æœ€ååˆ·æ–°æ—¶é—´
        function updateLastRefreshTime() {
            const now = new Date();
            lastRefreshTime = now;
            const timeStr = now.toLocaleTimeString('zh-CN', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            lastRefreshTimeEl.textContent = `æœ€ååˆ·æ–°: ${timeStr}`;
        }

        // å†å²è®°å½•ç®¡ç†
        function getHistory() {
            const historyStr = localStorage.getItem(HISTORY_KEY);
            return historyStr ? JSON.parse(historyStr) : [];
        }
        
        function addToHistory(address) {
            if (!address.trim()) return;
            let history = getHistory();
            history = history.filter(item => item !== address.trim());
            history.unshift(address.trim());
            if (history.length > MAX_HISTORY) history = history.slice(0, MAX_HISTORY);
            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
            renderHistory();
        }
        
        function renderHistory() {
            const history = getHistory();
            historyListEl.innerHTML = '';
            if (history.length === 0) {
                historyListEl.innerHTML = '<div class="history-item">æš‚æ— æŸ¥è¯¢è®°å½•</div>';
                return;
            }
            history.forEach(address => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `<span class="custom-icon">ğŸ“Œ</span> ${address}`;
                item.addEventListener('click', () => {
                    ipInput.value = address;
                    // ç‚¹å‡»å†å²è®°å½•æ—¶åœæ­¢è‡ªåŠ¨åˆ·æ–°å¹¶æ¸…é™¤ç»“æœ
                    stopAutoRefresh();
                    clearResults();
                });
                historyListEl.appendChild(item);
            });
        }
        
        function clearHistory() {
            localStorage.removeItem(HISTORY_KEY);
            renderHistory();
        }

        // åˆ†å‰²åœ°å€å’Œç«¯å£
        function splitAddressAndPort(fullAddress) {
            fullAddress = fullAddress.trim().replace(/ã€‚/g, '.');
            const lastColon = fullAddress.lastIndexOf(':');
            let address = fullAddress, port = '';
            if (lastColon > 0 && lastColon < fullAddress.length - 1) {
                address = fullAddress.substring(0, lastColon);
                port = fullAddress.substring(lastColon + 1);
            }
            if (port && (isNaN(port) || port < 1 || port > 65535)) {
                return { valid: false, error: 'ç«¯å£å¿…é¡»æ˜¯1-65535ä¹‹é—´çš„æ•°å­—' };
            }
            return { valid: true, address, port: port || '25565', fullAddress: address + (port ? ':' + port : '') };
        }

        // é€šç”¨APIè§£æå‡½æ•°ï¼ˆç”¨äºè‡ªå®šä¹‰APIï¼‰
        function genericApiParser(data) {
            // å°è¯•è§£æå„ç§å¯èƒ½çš„APIå“åº”æ ¼å¼
            let online = false;
            let players = { now: 0, max: 0 };
            let version = { name: 'æœªçŸ¥ç‰ˆæœ¬' };
            let protocol = null;
            let favicon = null;
            let serverName = 'æœªçŸ¥æœåŠ¡å™¨';
            let playerList = [];
            
            // æ–¹æ³•1ï¼šæ£€æŸ¥æ˜¯å¦åŒ…å«å¸¸è§çš„åœ¨çº¿å­—æ®µ
            if (data.online !== undefined) {
                online = Boolean(data.online);
            } else if (data.status === 'online') {
                online = true;
            } else if (data.isOnline !== undefined) {
                online = Boolean(data.isOnline);
            }
            
            // æ–¹æ³•2ï¼šæ£€æŸ¥ç©å®¶ä¿¡æ¯
            if (data.players) {
                if (typeof data.players === 'object') {
                    players.now = data.players.online || data.players.current || data.players.now || 0;
                    players.max = data.players.max || data.players.maximum || data.players.limit || 0;
                    
                    // æ£€æŸ¥ç©å®¶åˆ—è¡¨
                    if (data.players.list && Array.isArray(data.players.list)) {
                        playerList = data.players.list.map(p => ({
                            name: p.name || p.username || 'æœªçŸ¥ç©å®¶',
                            id: p.id || p.uuid || p.name || p.username || ''
                        }));
                    } else if (data.players.sample && Array.isArray(data.players.sample)) {
                        playerList = data.players.sample.map(p => ({
                            name: p.name || p.username || 'æœªçŸ¥ç©å®¶',
                            id: p.id || p.uuid || p.name || p.username || ''
                        }));
                    }
                }
            }
            
            // æ–¹æ³•3ï¼šæ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯
            if (data.version) {
                if (typeof data.version === 'string') {
                    version.name = data.version;
                } else if (typeof data.version === 'object') {
                    version.name = data.version.name || data.version.version || 'æœªçŸ¥ç‰ˆæœ¬';
                    if (data.version.protocol !== undefined) {
                        protocol = Number(data.version.protocol);
                    }
                }
            }
            
            // æ–¹æ³•4ï¼šæ£€æŸ¥åè®®å·
            if (data.protocol !== undefined && !isNaN(data.protocol)) {
                protocol = Number(data.protocol);
            }
            
            // æ–¹æ³•5ï¼šæ£€æŸ¥å›¾æ ‡
            if (data.favicon || data.icon) {
                favicon = data.favicon || data.icon;
            }
            
            // æ–¹æ³•6ï¼šæ£€æŸ¥æœåŠ¡å™¨åç§°/MOTD
            if (data.motd) {
                if (typeof data.motd === 'string') {
                    serverName = cleanMinecraftText(data.motd);
                } else if (data.motd.clean) {
                    const motdText = Array.isArray(data.motd.clean) ? data.motd.clean.join(' ') : data.motd.clean;
                    serverName = cleanMinecraftText(motdText);
                } else if (data.motd.text) {
                    serverName = cleanMinecraftText(data.motd.text);
                }
            } else if (data.description) {
                if (typeof data.description === 'string') {
                    serverName = cleanMinecraftText(data.description);
                } else if (data.description.text) {
                    serverName = cleanMinecraftText(data.description.text);
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åœ¨çº¿çŠ¶æ€ä½†æœ‰ç©å®¶ä¿¡æ¯ï¼Œåˆ™å‡è®¾æœåŠ¡å™¨åœ¨çº¿
            if (!online && (players.now > 0 || data.players)) {
                online = true;
            }
            
            return {
                online,
                players,
                version,
                protocol: isNaN(protocol) ? null : protocol,
                favicon,
                serverName,
                playerList
            };
        }

        // ==================== é»˜è®¤APIå®šä¹‰ï¼ˆå·²åˆ é™¤æŒ‡å®šAPIï¼‰====================
        const defaultApis = [
            // å›½å†…API (5ä¸ª)
            {
                name: 'mcsrvstat.us',
                region: 'domestic',
                buildUrl: (address, port) => 
                    `https://api.mcsrvstat.us/3/${encodeURIComponent(address)}:${port || 25565}`,
                parseResponse: (data) => {
                    let protocol = data.protocol;
                    if (protocol != null) protocol = Number(protocol); else protocol = null;
                    
                    let versionName = data.version;
                    if (!versionName || !extractVersionFromText(versionName)) {
                        const motdText = Array.isArray(data.motd?.clean) ? data.motd.clean.join(' ') : (data.motd?.clean || '');
                        const extracted = extractVersionFromText(motdText);
                        if (extracted) versionName = extracted;
                    }
                    
                    // å°è¯•è·å–æœåŠ¡å™¨åç§°
                    let serverName = '';
                    if (data.motd && data.motd.clean) {
                        const motdLines = Array.isArray(data.motd.clean) ? data.motd.clean : [data.motd.clean];
                        if (motdLines.length > 0) {
                            serverName = motdLines[0].trim();
                            // æ¸…ç†é¢œè‰²ä»£ç 
                            serverName = cleanMinecraftText(serverName);
                        }
                    }
                    
                    // å°è¯•è·å–ç©å®¶åˆ—è¡¨
                    let players = [];
                    if (data.players?.list && Array.isArray(data.players.list)) {
                        players = data.players.list.map(player => ({
                            name: player.name || player,
                            id: player.id || player.name || player
                        }));
                    }
                    
                    return {
                        online: data.online || false,
                        players: { now: data.players?.online || 0, max: data.players?.max || 0 },
                        version: { name: versionName || 'æœªçŸ¥ç‰ˆæœ¬' },
                        protocol: isNaN(protocol) ? null : protocol,
                        favicon: data.icon || null,
                        serverName: serverName || 'æœªçŸ¥æœåŠ¡å™¨',
                        playerList: players
                    };
                }
            },
            {
                name: 'mcstatus.io',
                region: 'domestic',
                buildUrl: (address, port) => 
                    `https://api.mcstatus.io/v2/status/java/${encodeURIComponent(address)}:${port || 25565}`,
                parseResponse: (data) => {
                    let protocol = data.version?.protocol;
                    if (protocol != null) protocol = Number(protocol); else protocol = null;
                    
                    let versionName = data.version?.name_raw || data.version?.name;
                    if (!versionName || !extractVersionFromText(versionName)) {
                        const motdText = data.motd?.clean || '';
                        const extracted = extractVersionFromText(motdText);
                        if (extracted) versionName = extracted;
                    }
                    
                    // å°è¯•è·å–è¿è¡Œæ—¶é—´ä¿¡æ¯
                    let uptime = null;
                    if (data.server && data.server.uptime) {
                        uptime = data.server.uptime;
                        // å¦‚æœuptimeæ˜¯æ¯«ç§’ï¼Œè½¬æ¢ä¸ºç§’
                        if (uptime > 1000000) {
                            uptime = Math.floor(uptime / 1000);
                        }
                    }
                    
                    // å°è¯•è·å–æœåŠ¡å™¨åç§°
                    let serverName = '';
                    if (data.motd && data.motd.clean) {
                        const motdText = data.motd.clean;
                        if (motdText && motdText.trim().length > 0) {
                            serverName = motdText.trim().split('\n')[0];
                            serverName = cleanMinecraftText(serverName);
                        }
                    }
                    
                    // å°è¯•è·å–ç©å®¶åˆ—è¡¨
                    let players = [];
                    if (data.players?.list && Array.isArray(data.players.list)) {
                        players = data.players.list.map(player => ({
                            name: player.name_clean || player.name_raw || 'æœªçŸ¥ç©å®¶',
                            id: player.uuid || player.name_clean || player.name_raw || ''
                        }));
                    }
                    
                    return {
                        online: data.online || false,
                        players: { now: data.players?.online || 0, max: data.players?.max || 0 },
                        version: { name: versionName || 'æœªçŸ¥ç‰ˆæœ¬' },
                        protocol: isNaN(protocol) ? null : protocol,
                        favicon: data.icon || null,
                        serverName: serverName || 'æœªçŸ¥æœåŠ¡å™¨',
                        uptime: uptime,
                        uptimeText: uptime ? formatUptime(uptime) : 'æœªçŸ¥',
                        playerList: players
                    };
                }
            },
            {
                name: 'mcapi.us',
                region: 'domestic',
                buildUrl: (address, port) => 
                    `https://mcapi.us/server/status?ip=${encodeURIComponent(address)}&port=${port || 25565}`,
                parseResponse: (data) => {
                    let protocol = null;
                    if (data.version?.protocol != null) protocol = Number(data.version.protocol);
                    else if (data.server?.protocol != null) protocol = Number(data.server.protocol);
                    
                    let versionName = data.version?.name;
                    if (!versionName || !extractVersionFromText(versionName)) {
                        const motdText = Array.isArray(data.motd?.clean) ? data.motd.clean.join(' ') : (data.motd?.clean || '');
                        const extracted = extractVersionFromText(motdText);
                        if (extracted) versionName = extracted;
                    }
                    
                    // å°è¯•è·å–æœåŠ¡å™¨åç§°
                    let serverName = '';
                    if (data.motd && data.motd.clean) {
                        const motdLines = Array.isArray(data.motd.clean) ? data.motd.clean : [data.motd.clean];
                        if (motdLines.length > 0) {
                            serverName = motdLines[0].trim();
                            serverName = cleanMinecraftText(serverName);
                        }
                    }
                    
                    // å°è¯•è·å–ç©å®¶åˆ—è¡¨
                    let players = [];
                    if (data.players?.sample && Array.isArray(data.players.sample)) {
                        players = data.players.sample.map(player => ({
                            name: player.name || 'æœªçŸ¥ç©å®¶',
                            id: player.id || player.name || ''
                        }));
                    }
                    
                    return {
                        online: data.online || false,
                        players: { now: data.players?.now || 0, max: data.players?.max || 0 },
                        version: { name: versionName || 'æœªçŸ¥ç‰ˆæœ¬' },
                        protocol: isNaN(protocol) ? null : protocol,
                        favicon: data.favicon || null,
                        serverName: serverName || 'æœªçŸ¥æœåŠ¡å™¨',
                        playerList: players
                    };
                }
            },
            {
                name: 'mcapis.com',
                region: 'domestic',
                buildUrl: (address, port) => 
                    `https://api.mcapis.com/status/java/${encodeURIComponent(address)}:${port || 25565}`,
                parseResponse: (data) => {
                    let protocol = data.version?.protocol;
                    if (protocol != null) protocol = Number(protocol); else protocol = null;
                    
                    let versionName = data.version?.name;
                    if (!versionName || !extractVersionFromText(versionName)) {
                        const motdText = data.motd?.clean || '';
                        const extracted = extractVersionFromText(motdText);
                        if (extracted) versionName = extracted;
                    }
                    
                    // å°è¯•è·å–æœåŠ¡å™¨åç§°
                    let serverName = '';
                    if (data.motd && data.motd.clean) {
                        const motdText = data.motd.clean;
                        if (motdText && motdText.trim().length > 0) {
                            serverName = motdText.trim().split('\n')[0];
                            serverName = cleanMinecraftText(serverName);
                        }
                    }
                    
                    // å°è¯•è·å–ç©å®¶åˆ—è¡¨
                    let players = [];
                    if (data.players?.list && Array.isArray(data.players.list)) {
                        players = data.players.list.map(player => ({
                            name: player.name || 'æœªçŸ¥ç©å®¶',
                            id: player.id || player.name || ''
                        }));
                    }
                    
                    return {
                        online: data.online || false,
                        players: { now: data.players?.online || 0, max: data.players?.max || 0 },
                        version: { name: versionName || 'æœªçŸ¥ç‰ˆæœ¬' },
                        protocol: isNaN(protocol) ? null : protocol,
                        favicon: data.favicon || null,
                        serverName: serverName || 'æœªçŸ¥æœåŠ¡å™¨',
                        playerList: players
                    };
                }
            },
            {
                name: 'mcapi.ca',
                region: 'domestic',
                buildUrl: (address, port) => 
                    `https://mcapi.ca/query/${encodeURIComponent(address)}:${port || 25565}`,
                parseResponse: (data) => {
                    let protocol = null;
                    if (data.version?.protocol != null) protocol = Number(data.version.protocol);
                    else if (data.server?.protocol != null) protocol = Number(data.server.protocol);
                    
                    let versionName = data.version?.name;
                    if (!versionName || !extractVersionFromText(versionName)) {
                        const motdText = Array.isArray(data.motd?.clean) ? data.motd.clean.join(' ') : (data.motd?.clean || '');
                        const extracted = extractVersionFromText(motdText);
                        if (extracted) versionName = extracted;
                    }
                    
                    // å°è¯•è·å–æœåŠ¡å™¨åç§°
                    let serverName = '';
                    if (data.motd && data.motd.clean) {
                        const motdLines = Array.isArray(data.motd.clean) ? data.motd.clean : [data.motd.clean];
                        if (motdLines.length > 0) {
                            serverName = motdLines[0].trim();
                            serverName = cleanMinecraftText(serverName);
                        }
                    }
                    
                    return {
                        online: data.online || false,
                        players: { now: data.players?.now || 0, max: data.players?.max || 0 },
                        version: { name: versionName || 'æœªçŸ¥ç‰ˆæœ¬' },
                        protocol: isNaN(protocol) ? null : protocol,
                        favicon: data.favicon || null,
                        serverName: serverName || 'æœªçŸ¥æœåŠ¡å™¨',
                        playerList: [] // æ­¤APIé€šå¸¸ä¸è¿”å›ç©å®¶åˆ—è¡¨
                    };
                }
            },
            
            // å›½å¤–API (3ä¸ª)
            {
                name: 'minetools.eu',
                region: 'foreign',
                buildUrl: (address, port) => 
                    `https://api.minetools.eu/ping/${encodeURIComponent(address)}/${port || 25565}`,
                parseResponse: (data) => {
                    if (data.error) {
                        return { 
                            online: false, 
                            players: { now: 0, max: 0 }, 
                            version: { name: 'æœªçŸ¥ç‰ˆæœ¬' }, 
                            protocol: null, 
                            favicon: null,
                            serverName: 'æœªçŸ¥æœåŠ¡å™¨',
                            playerList: []
                        };
                    }
                    
                    let protocol = data.version?.protocol;
                    if (protocol != null) protocol = Number(protocol); else protocol = null;
                    
                    let versionName = data.version?.name;
                    if (!versionName || !extractVersionFromText(versionName)) {
                        // æ²¡æœ‰ MOTD
                    }
                    
                    // å°è¯•è·å–æœåŠ¡å™¨åç§°
                    let serverName = '';
                    if (data.description && data.description.text) {
                        serverName = cleanMinecraftText(data.description.text);
                    }
                    
                    // å°è¯•è·å–ç©å®¶åˆ—è¡¨
                    let players = [];
                    if (data.players?.sample && Array.isArray(data.players.sample)) {
                        players = data.players.sample.map(player => ({
                            name: player.name || 'æœªçŸ¥ç©å®¶',
                            id: player.id || player.name || ''
                        }));
                    }
                    
                    return {
                        online: true,
                        players: { now: data.players?.online || 0, max: data.players?.max || 0 },
                        version: { name: versionName || 'æœªçŸ¥ç‰ˆæœ¬' },
                        protocol: isNaN(protocol) ? null : protocol,
                        favicon: data.favicon || null,
                        serverName: serverName || 'æœªçŸ¥æœåŠ¡å™¨',
                        playerList: players
                    };
                }
            },
            {
                name: 'eu.mcapi.io',
                region: 'foreign',
                buildUrl: (address, port) => 
                    `https://eu.mcapi.io/server/${encodeURIComponent(address)}/${port || 25565}`,
                parseResponse: (data) => {
                    let protocol = data.protocol;
                    if (protocol != null) protocol = Number(protocol); else protocol = null;
                    
                    let versionName = data.version?.name;
                    if (!versionName || !extractVersionFromText(versionName)) {
                        // æ²¡æœ‰ MOTDï¼Œæ— æ³•æå–
                    }
                    
                    return {
                        online: data.online || false,
                        players: { now: data.players?.online || 0, max: data.players?.max || 0 },
                        version: { name: versionName || 'æœªçŸ¥ç‰ˆæœ¬' },
                        protocol: isNaN(protocol) ? null : protocol,
                        favicon: data.favicon || null,
                        serverName: 'æœªçŸ¥æœåŠ¡å™¨', // æ­¤APIé€šå¸¸ä¸è¿”å›æœåŠ¡å™¨åç§°
                        playerList: [] // æ­¤APIé€šå¸¸ä¸è¿”å›ç©å®¶åˆ—è¡¨
                    };
                }
            },
            {
                name: 'mcapi.cc',
                region: 'foreign',
                buildUrl: (address, port) => 
                    `https://mcapi.cc/${encodeURIComponent(address)}:${port || 25565}`,
                parseResponse: (data) => {
                    // è¿™ä¸ªAPIè¿”å›æ ¼å¼å¯èƒ½ä¸åŒï¼Œéœ€è¦é€‚é…
                    if (data.error) {
                        return { 
                            online: false, 
                            players: { now: 0, max: 0 }, 
                            version: { name: 'æœªçŸ¥ç‰ˆæœ¬' }, 
                            protocol: null, 
                            favicon: null,
                            serverName: 'æœªçŸ¥æœåŠ¡å™¨',
                            playerList: []
                        };
                    }
                    
                    let protocol = data.protocol;
                    if (protocol != null) protocol = Number(protocol); else protocol = null;
                    
                    let versionName = data.version;
                    if (!versionName || !extractVersionFromText(versionName)) {
                        const motdText = Array.isArray(data.motd) ? data.motd.join(' ') : (data.motd || '');
                        const extracted = extractVersionFromText(motdText);
                        if (extracted) versionName = extracted;
                    }
                    
                    // å°è¯•è·å–æœåŠ¡å™¨åç§°
                    let serverName = '';
                    if (data.motd) {
                        const motdText = Array.isArray(data.motd) ? data.motd.join(' ') : data.motd;
                        if (motdText && motdText.trim().length > 0) {
                            serverName = motdText.trim().split('\n')[0];
                            serverName = cleanMinecraftText(serverName);
                        }
                    }
                    
                    return {
                        online: data.online || false,
                        players: { now: data.players?.online || 0, max: data.players?.max || 0 },
                        version: { name: versionName || 'æœªçŸ¥ç‰ˆæœ¬' },
                        protocol: isNaN(protocol) ? null : protocol,
                        favicon: null, // è¿™ä¸ªAPIé€šå¸¸ä¸è¿”å›å›¾æ ‡
                        serverName: serverName || 'æœªçŸ¥æœåŠ¡å™¨',
                        playerList: [] // æ­¤APIé€šå¸¸ä¸è¿”å›ç©å®¶åˆ—è¡¨
                    };
                }
            }
        ];

        // ==================== åˆå¹¶å¤šä¸ªAPIç»“æœ ====================
        function mergeApiResults(resultsWithPing) {
            if (resultsWithPing.length === 0) return null;
            
            apiResults = resultsWithPing; // ä¿å­˜APIç»“æœç”¨äºæ˜¾ç¤º

            const results = resultsWithPing.map(r => r.data);
            
            // æ‰¾åˆ°ç¬¬ä¸€ä¸ªåœ¨çº¿æœåŠ¡å™¨ä½œä¸ºåŸºç¡€
            let base = results.find(r => r && r.online === true) || results[0];
            
            if (!base) return null;
            
            // ç©å®¶æ•°é‡å¤„ç† - ä½¿ç”¨ä¸­ä½æ•°é¿å…å¼‚å¸¸å€¼ï¼ˆä¿®å¤2b2tç­‰å¤§å‹æœåŠ¡å™¨æ˜¾ç¤ºé—®é¢˜ï¼‰
            let maxNow = 0;
            let maxMax = 0;

            // å…ˆæ‰¾åˆ°æ‰€æœ‰è¿”å›åœ¨çº¿çŠ¶æ€çš„API
            const onlineResults = results.filter(r => r && r.online === true);

            if (onlineResults.length > 0) {
                // ä½¿ç”¨ä¸­ä½æ•°è€Œä¸æ˜¯æœ€å¤§å€¼ï¼Œé¿å…å¼‚å¸¸å€¼
                const nowValues = onlineResults.map(r => r.players.now || 0).sort((a, b) => a - b);
                const maxValues = onlineResults.map(r => r.players.max || 0).sort((a, b) => a - b);
                
                // å–ä¸­ä½æ•°
                const midIndex = Math.floor(nowValues.length / 2);
                maxNow = nowValues[midIndex];
                maxMax = maxValues[midIndex];
                
                console.log('ç©å®¶æ•°é‡ç»Ÿè®¡:', {
                    onlineAPIs: onlineResults.length,
                    nowValues: nowValues,
                    maxValues: maxValues,
                    medianNow: maxNow,
                    medianMax: maxMax
                });
            } else {
                // å¦‚æœæ²¡æœ‰åœ¨çº¿ç»“æœï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªç»“æœçš„å€¼
                maxNow = base.players.now || 0;
                maxMax = base.players.max || 0;
            }

            base.players.now = maxNow;
            base.players.max = maxMax;

            // å…¶ä»–å­—æ®µè¡¥å……
            for (const res of results) {
                if (!res || res === base) continue;
                if ((!base.version.name || base.version.name === 'æœªçŸ¥ç‰ˆæœ¬') && res.version.name && res.version.name !== 'æœªçŸ¥ç‰ˆæœ¬')
                    base.version.name = res.version.name;
                if ((base.protocol == null || isNaN(base.protocol)) && res.protocol != null && !isNaN(res.protocol))
                    base.protocol = res.protocol;
                if (!base.favicon && res.favicon) base.favicon = res.favicon;
                if ((!base.serverName || base.serverName === 'æœªçŸ¥æœåŠ¡å™¨') && res.serverName && res.serverName !== 'æœªçŸ¥æœåŠ¡å™¨')
                    base.serverName = res.serverName;
            }

            // åˆå¹¶ç©å®¶åˆ—è¡¨ï¼ˆå»é‡ï¼‰
            playersList = [];
            const playerNames = new Set();
            
            resultsWithPing.forEach(result => {
                if (result.data && result.data.playerList && Array.isArray(result.data.playerList)) {
                    result.data.playerList.forEach(player => {
                        const playerName = cleanMinecraftText(player.name || '');
                        if (playerName && playerName !== 'æœªçŸ¥ç©å®¶' && !playerNames.has(playerName)) {
                            playerNames.add(playerName);
                            playersList.push({
                                name: playerName,
                                id: player.id || playerName
                            });
                        }
                    });
                }
            });
            
            console.log('åˆå¹¶åçš„ç©å®¶åˆ—è¡¨:', playersList);

            // è®¡ç®—å›½å†…å»¶è¿Ÿï¼ˆå›½å†…èŠ‚ç‚¹ï¼Œå‰5ä¸ªï¼‰ - å¿½ç•¥å¤±è´¥çš„èŠ‚ç‚¹
            const domesticPings = resultsWithPing
                .filter((item, idx) => idx < 5 && item.ping !== null && item.success && item.data && item.data.online)
                .map(item => item.ping);
            
            let chinaMin = null, chinaMax = null;
            if (domesticPings.length > 0) {
                chinaMin = Math.min(...domesticPings);
                chinaMax = Math.max(...domesticPings);
                // è®¡ç®—å¹³å‡å»¶è¿Ÿï¼ˆç®—æœ¯å¹³å‡ï¼‰
                const sum = domesticPings.reduce((a, b) => a + b, 0);
                avgPing = Math.round(sum / domesticPings.length);
                
                // è®°å½•æˆåŠŸèŠ‚ç‚¹æ•°é‡
                console.log(`å›½å†…æˆåŠŸèŠ‚ç‚¹: ${domesticPings.length}ä¸ª, å»¶è¿Ÿ: ${domesticPings.join(', ')}ms, å¹³å‡: ${avgPing}ms`);
            } else {
                avgPing = null;
                console.log('å›½å†…æ‰€æœ‰èŠ‚ç‚¹å‡å¤±è´¥');
            }
            
            // è®¡ç®—å›½å¤–å»¶è¿Ÿï¼ˆå›½å¤–èŠ‚ç‚¹ï¼Œå3ä¸ªï¼‰
            const foreignPings = resultsWithPing
                .filter((item, idx) => idx >= 5 && idx < 8 && item.ping !== null && item.success && item.data && item.data.online)
                .map(item => item.ping);
            
            let foreignMin = null, foreignMax = null, foreignAvg = null;
            if (foreignPings.length > 0) {
                foreignMin = Math.min(...foreignPings);
                foreignMax = Math.max(...foreignPings);
                const foreignSum = foreignPings.reduce((a, b) => a + b, 0);
                foreignAvg = Math.round(foreignSum / foreignPings.length);
                
                console.log(`å›½å¤–æˆåŠŸèŠ‚ç‚¹: ${foreignPings.length}ä¸ª, å»¶è¿Ÿ: ${foreignPings.join(', ')}ms, å¹³å‡: ${foreignAvg}ms`);
            }

            // åˆå¹¶æœåŠ¡å™¨è¿è¡Œæ—¶é—´ä¿¡æ¯ï¼ˆå–æœ€é•¿çš„è¿è¡Œæ—¶é—´ï¼‰
            let serverUptime = null;
            let serverUptimeText = 'æœªçŸ¥';
            
            // æŸ¥æ‰¾æ‰€æœ‰åŒ…å«è¿è¡Œæ—¶é—´çš„ç»“æœï¼Œå–æœ€é•¿çš„è¿è¡Œæ—¶é—´
            const uptimeResults = results.filter(r => r && r.uptime && r.uptime > 0);
            if (uptimeResults.length > 0) {
                // å–æœ€é•¿çš„è¿è¡Œæ—¶é—´
                serverUptime = Math.max(...uptimeResults.map(r => r.uptime));
                serverUptimeText = formatUptime(serverUptime);
                
                // è®°å½•æ—¥å¿—
                console.log('æœåŠ¡å™¨è¿è¡Œæ—¶é—´ç»Ÿè®¡:', {
                    uptimeAPIs: uptimeResults.length,
                    uptimes: uptimeResults.map(r => r.uptime),
                    maxUptime: serverUptime,
                    formatted: serverUptimeText
                });
            }
            
            // æ·»åŠ åˆ°baseå¯¹è±¡
            base.uptime = serverUptime;
            base.uptimeText = serverUptimeText;

            return { 
                data: base, 
                chinaMin, 
                chinaMax, 
                foreignMin,
                foreignMax,
                foreignAvg,
                players: playersList 
            };
        }

        // å¸¦è¶…æ—¶çš„fetchè¯·æ±‚
        async function fetchWithTimeout(url, timeout = 4000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(url, { 
                    method: 'GET', 
                    mode: 'cors',
                    signal: controller.signal 
                });
                clearTimeout(timeoutId);
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                clearTimeout(timeoutId);
                throw error;
            }
        }

        // ==================== è‡ªå®šä¹‰APIç®¡ç† ====================
        // åŠ è½½è‡ªå®šä¹‰API
        function loadCustomApis() {
            const customApisStr = localStorage.getItem(CUSTOM_APIS_KEY);
            customApis = customApisStr ? JSON.parse(customApisStr) : [];
            renderCustomApis();
        }
        
        // ä¿å­˜è‡ªå®šä¹‰API
        function saveCustomApis() {
            localStorage.setItem(CUSTOM_APIS_KEY, JSON.stringify(customApis));
            renderCustomApis();
        }
        
        // æ·»åŠ è‡ªå®šä¹‰API
        function addCustomApi(name, urlTemplate) {
            if (!name.trim()) {
                alert('è¯·è¾“å…¥APIåç§°');
                return false;
            }
            
            if (!urlTemplate.trim()) {
                alert('è¯·è¾“å…¥API URLæ¨¡æ¿');
                return false;
            }
            
            // æ£€æŸ¥URLæ¨¡æ¿æ˜¯å¦åŒ…å«å ä½ç¬¦
            if (!urlTemplate.includes('{address}') || !urlTemplate.includes('{port}')) {
                if (!confirm('URLæ¨¡æ¿ä¸­æœªåŒ…å« {address} å’Œ {port} å ä½ç¬¦ï¼Œå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚æ˜¯å¦ç»§ç»­æ·»åŠ ï¼Ÿ')) {
                    return false;
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒåç§°çš„API
            if (customApis.some(api => api.name === name.trim())) {
                alert('å·²å­˜åœ¨ç›¸åŒåç§°çš„API');
                return false;
            }
            
            // æ·»åŠ è‡ªå®šä¹‰API
            const newApi = {
                id: Date.now().toString(),
                name: name.trim(),
                urlTemplate: urlTemplate.trim(),
                enabled: true,
                region: 'custom'
            };
            
            customApis.push(newApi);
            saveCustomApis();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            customApiNameInput.value = '';
            customApiUrlInput.value = '';
            
            return true;
        }
        
        // åˆ é™¤è‡ªå®šä¹‰API
        function deleteCustomApi(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤æ­¤è‡ªå®šä¹‰APIå—ï¼Ÿ')) {
                return;
            }
            
            customApis = customApis.filter(api => api.id !== id);
            saveCustomApis();
        }
        
        // å¯ç”¨/ç¦ç”¨è‡ªå®šä¹‰API
        function toggleCustomApi(id) {
            const api = customApis.find(api => api.id === id);
            if (api) {
                api.enabled = !api.enabled;
                saveCustomApis();
            }
        }
        
        // æ¸²æŸ“è‡ªå®šä¹‰APIåˆ—è¡¨
        function renderCustomApis() {
            customApiListEl.innerHTML = '';
            
            if (customApis.length === 0) {
                customApiListEl.innerHTML = '<div class="no-custom-apis"><span class="icon-emoji">ğŸ“­</span> æš‚æ— è‡ªå®šä¹‰API</div>';
                updateApiStats();
                return;
            }
            
            customApis.forEach((api, index) => {
                const apiItem = document.createElement('div');
                apiItem.className = 'custom-api-item';
                apiItem.style.animationDelay = `${index * 0.05}s`;
                apiItem.innerHTML = `
                    <div class="custom-api-info">
                        <div class="custom-api-name"><span class="custom-icon">ğŸ”§</span> ${api.name} ${api.enabled ? 'âœ…' : 'â›”'}</div>
                        <div class="custom-api-url" title="${api.urlTemplate}">${api.urlTemplate}</div>
                    </div>
                    <div class="custom-api-actions">
                        <button class="api-action-btn ${api.enabled ? 'disable' : 'enable'}" data-action="toggle" data-id="${api.id}">
                            ${api.enabled ? '<span class="icon-emoji">â›”</span> ç¦ç”¨' : '<span class="icon-emoji">âœ…</span> å¯ç”¨'}
                        </button>
                        <button class="api-action-btn delete" data-action="delete" data-id="${api.id}"><span class="icon-emoji">ğŸ—‘ï¸</span> åˆ é™¤</button>
                    </div>
                `;
                customApiListEl.appendChild(apiItem);
            });
            
            updateApiStats();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.querySelectorAll('.api-action-btn[data-action="delete"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteCustomApi(id);
                });
            });
            
            document.querySelectorAll('.api-action-btn[data-action="toggle"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    toggleCustomApi(id);
                });
            });
        }
        
        // æ›´æ–°APIç»Ÿè®¡ä¿¡æ¯
        function updateApiStats() {
            const enabledCount = customApis.filter(api => api.enabled).length;
            const totalCount = customApis.length;
            
            enabledApiCountEl.textContent = enabledCount;
            totalApiCountEl.textContent = totalCount;
            
            // æ·»åŠ æ•°å€¼å˜åŒ–åŠ¨ç”»
            enabledApiCountEl.classList.add('value-change');
            totalApiCountEl.classList.add('value-change');
            setTimeout(() => {
                enabledApiCountEl.classList.remove('value-change');
                totalApiCountEl.classList.remove('value-change');
            }, 500);
        }
        
        // åˆ‡æ¢è‡ªå®šä¹‰APIé¢æ¿çš„å±•å¼€çŠ¶æ€
        function toggleCustomApiPanel() {
            isCustomApiExpanded = !isCustomApiExpanded;
            
            if (isCustomApiExpanded) {
                customApiContent.classList.add('expanded');
                customApiArrow.classList.add('expanded');
            } else {
                customApiContent.classList.remove('expanded');
                customApiArrow.classList.remove('expanded');
            }
        }
        
        // æ„å»ºæ‰€æœ‰APIåˆ—è¡¨ï¼ˆé»˜è®¤API + è‡ªå®šä¹‰APIï¼‰
        function getAllApis() {
            const enabledCustomApis = customApis
                .filter(api => api.enabled)
                .map(api => ({
                    name: api.name,
                    region: 'custom',
                    buildUrl: (address, port) => {
                        // æ›¿æ¢å ä½ç¬¦
                        let url = api.urlTemplate
                            .replace(/{address}/g, encodeURIComponent(address))
                            .replace(/{port}/g, port || '25565');
                        return url;
                    },
                    parseResponse: genericApiParser
                }));
            
            return [...defaultApis, ...enabledCustomApis];
        }

        // ==================== æŸ¥è¯¢å‡½æ•° ====================
        async function queryServerStatus(isAutoRefresh = false) {
            if (isRequesting) return;
            
            const full = ipInput.value;
            if (!full.trim()) {
                if (!isAutoRefresh) alert('è¯·è¾“å…¥æœåŠ¡å™¨åœ°å€');
                return;
            }
            
            const res = splitAddressAndPort(full);
            if (!res.valid) {
                if (!isAutoRefresh) alert(res.error);
                return;
            }
            
            currentAddress = res.fullAddress;
            
            if (!isAutoRefresh) {
                disableButtons();
                queryBtn.innerHTML = '<span class="loading"></span> æŸ¥è¯¢ä¸­...';
                // æ˜¾ç¤ºåˆ·æ–°é®ç½©
                refreshMask.classList.add('active');
            } else {
                // è‡ªåŠ¨åˆ·æ–°æ—¶æ˜¾ç¤ºåˆ·æ–°æŒ‡ç¤ºå™¨åŠ¨ç”»
                refreshIndicator.classList.add('refreshing');
            }
            
            isRequesting = true;

            const resultsWithPing = [];
            
            // è·å–æ‰€æœ‰APIï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰APIï¼‰
            const allApis = getAllApis();

            // å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰APIï¼ˆä½¿ç”¨è¶…æ—¶ï¼‰
            const promises = allApis.map(async (api, index) => {
                const start = Date.now();
                try {
                    const url = api.buildUrl(res.address, res.port);
                    // ä½¿ç”¨å¸¦è¶…æ—¶çš„fetch
                    const rawData = await fetchWithTimeout(url, 3000);
                    const ping = Date.now() - start;
                    const parsed = api.parseResponse(rawData);
                    return { 
                        apiName: api.name, 
                        region: api.region,
                        ping, 
                        data: parsed, 
                        success: true,
                        index: index
                    };
                } catch (e) {
                    console.warn(`API ${api.name} å¤±è´¥:`, e.message);
                    return { 
                        apiName: api.name, 
                        region: api.region, 
                        ping: null, 
                        data: null, 
                        success: false, 
                        error: e.message,
                        index: index
                    };
                }
            });

            try {
                // è®¾ç½®æ€»è¶…æ—¶æ—¶é—´
                const timeoutPromise = new Promise((_, reject) => {
                    setTimeout(() => reject(new Error('æŸ¥è¯¢è¶…æ—¶')), 8000);
                });
                
                // ä½¿ç”¨Promise.raceï¼Œè¦ä¹ˆæ‰€æœ‰APIæŸ¥è¯¢å®Œæˆï¼Œè¦ä¹ˆè¶…æ—¶
                const results = await Promise.race([
                    Promise.allSettled(promises),
                    timeoutPromise
                ]);
                
                // å¤„ç†ç»“æœ
                if (Array.isArray(results)) {
                    results.forEach(result => {
                        if (result.status === 'fulfilled' && result.value.success && result.value.data) {
                            resultsWithPing.push(result.value);
                        } else {
                            // å³ä½¿æ˜¯å¤±è´¥çš„èŠ‚ç‚¹ï¼Œä¹Ÿè®°å½•ä¸‹æ¥ï¼Œä½†æ ‡è®°ä¸ºå¤±è´¥
                            const apiInfo = allApis[result.value?.index || 0];
                            resultsWithPing.push({ 
                                apiName: apiInfo?.name || 'æœªçŸ¥API', 
                                region: apiInfo?.region || 'unknown',
                                ping: null, 
                                data: null,
                                success: false 
                            });
                        }
                    });
                }
                
                console.log(`æŸ¥è¯¢å®Œæˆï¼ŒæˆåŠŸAPIæ•°é‡: ${resultsWithPing.filter(r => r.success).length}/${allApis.length}`);
                
            } catch (error) {
                console.error('æŸ¥è¯¢è¶…æ—¶:', error);
                // å³ä½¿è¶…æ—¶ï¼Œä¹Ÿå°è¯•æ˜¾ç¤ºå·²è·å–çš„ç»“æœ
            }

            // åªè¦æœ‰æˆåŠŸç»“æœå°±æ˜¾ç¤º
            if (resultsWithPing.some(item => item.success && item.data)) {
                const merged = mergeApiResults(resultsWithPing);
                if (merged && merged.data) {
                    // å…³é”®ä¿®æ”¹ï¼šåªæœ‰å½“æœåŠ¡å™¨åœ¨çº¿æ—¶æ‰æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯
                    if (merged.data.online) {
                        displayResult(merged.data, merged.chinaMin, merged.chinaMax);
                        displayPingAndApiDetails(resultsWithPing, merged.chinaMin, merged.chinaMax, merged.foreignAvg);
                        // ä¼ é€’æ€»åœ¨çº¿äººæ•°ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼ˆä¿®å¤2b2tæ˜¾ç¤ºé—®é¢˜ï¼‰
                        displayPlayersList(merged.players, merged.data.players.now);
                        
                        // æ›´æ–°çŠ¶æ€æ å»¶è¿Ÿæ˜¾ç¤º
                        updateStatusPingDisplay();
                        
                        if (!isAutoRefresh) {
                            addToHistory(res.fullAddress);
                            // é¦–æ¬¡æŸ¥è¯¢åï¼Œè®°å½•å½“å‰æŸ¥è¯¢åœ°å€å¹¶æ ¹æ®å¼€å…³çŠ¶æ€å†³å®šæ˜¯å¦å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
                            currentQueryAddress = full;
                            if (isAutoRefreshEnabled && autoRefreshToggle.checked) {
                                startAutoRefresh();
                            }
                        }
                        
                        // æ›´æ–°åˆ·æ–°æ—¶é—´
                        updateLastRefreshTime();
                    } else {
                        // æœåŠ¡å™¨ç¦»çº¿ï¼Œæ˜¾ç¤ºç¦»çº¿çŠ¶æ€
                        displayOfflineResult();
                        // ç¦»çº¿æ—¶åœæ­¢è‡ªåŠ¨åˆ·æ–°
                        stopAutoRefresh();
                        if (!isAutoRefresh) {
                            addToHistory(res.fullAddress);
                        }
                    }
                } else {
                    if (!isAutoRefresh) {
                        alert('æœåŠ¡å™¨å¯èƒ½ç¦»çº¿æˆ–ä¸å¯è®¿é—®');
                        // æ˜¾ç¤ºç¦»çº¿çŠ¶æ€
                        displayOfflineResult();
                    }
                }
            } else {
                if (!isAutoRefresh) {
                    alert('æ— æ³•è·å–æœåŠ¡å™¨çŠ¶æ€ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•');
                    // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
                    onlineCountEl.textContent = '--';
                    maxCountEl.textContent = '--';
                    serverVersionEl.textContent = 'é”™è¯¯';
                    avgPingEl.textContent = '--';
                    
                    onlineCountEl.style.color = '#f59e0b';
                    maxCountEl.style.color = '#f59e0b';
                    serverVersionEl.style.color = '#f59e0b';
                    avgPingEl.style.color = '#e0e0e0';
                    
                    // æŸ¥è¯¢å¤±è´¥æ—¶åœæ­¢è‡ªåŠ¨åˆ·æ–°
                    stopAutoRefresh();
                }
            }

            if (!isAutoRefresh) {
                enableButtons();
                queryBtn.innerHTML = '<span class="icon-emoji">ğŸ”</span> æŸ¥è¯¢æœåŠ¡å™¨';
                // éšè—åˆ·æ–°é®ç½©
                refreshMask.classList.remove('active');
            } else {
                // ç§»é™¤è‡ªåŠ¨åˆ·æ–°æŒ‡ç¤ºå™¨åŠ¨ç”»
                refreshIndicator.classList.remove('refreshing');
            }
            
            isRequesting = false;
        }

        // æ˜¾ç¤ºç¦»çº¿ç»“æœ
        function displayOfflineResult() {
            // æ·»åŠ æ•°å€¼å˜åŒ–åŠ¨ç”»
            onlineCountEl.classList.add('value-change');
            maxCountEl.classList.add('value-change');
            serverVersionEl.classList.add('value-change');
            
            setTimeout(() => {
                onlineCountEl.classList.remove('value-change');
                maxCountEl.classList.remove('value-change');
                serverVersionEl.classList.remove('value-change');
            }, 500);
            
            onlineCountEl.textContent = '0';
            maxCountEl.textContent = '0';
            serverVersionEl.textContent = 'ç¦»çº¿';
            avgPingEl.textContent = '--';
            
            onlineCountEl.style.color = '#ef4444';
            maxCountEl.style.color = '#ef4444';
            serverVersionEl.style.color = '#ef4444';
            avgPingEl.style.color = '#e0e0e0';
            
            // æ¸…ç©ºå»¶è¿Ÿå’ŒAPIæ ‡ç­¾é¡µçš„å†…å®¹
            pingApiContent.innerHTML = '<p style="color: #b0b0c0; text-align: center; margin-top: 20px;"><span class="icon-emoji">ğŸ”´</span> æœåŠ¡å™¨ç¦»çº¿ï¼Œæ— æ³•è·å–å»¶è¿Ÿå’ŒAPIä¿¡æ¯</p>';
            
            // æ¸…ç©ºç©å®¶åˆ—è¡¨æ ‡ç­¾é¡µçš„å†…å®¹
            playersContent.innerHTML = '<p class="no-players"><span class="icon-emoji">ğŸ”´</span> æœåŠ¡å™¨ç¦»çº¿ï¼Œæ— ç©å®¶åœ¨çº¿</p>';
            playersCountEl.textContent = '0 ä½ç©å®¶';
            
            // æ˜¾ç¤ºç¦»çº¿è¯¦æƒ…ï¼ˆå¤´åƒå°ºå¯¸ç»Ÿä¸€ä¸º120pxï¼‰
            const serverDetailsHtml = `
                <div class="server-details-header">
                    <div class="server-avatar-name-row">
                        <div class="server-avatar-container">
                            <div class="no-icon" style="width: 120px; height: 120px; font-size: 2rem;"><span class="icon-emoji">ğŸ”´</span></div>
                        </div>
                        <div class="server-name-container">
                            <div class="server-name">${currentAddress}</div>
                        </div>
                    </div>
                </div>
                <div class="server-details-grid">
                    <div class="detail-item">
                        <div class="detail-label"><span class="icon-emoji">ğŸ“Š</span> æœåŠ¡å™¨çŠ¶æ€</div>
                        <div class="detail-value offline">ç¦»çº¿</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label"><span class="icon-emoji">ğŸ‘¥</span> å½“å‰/æœ€å¤§ç©å®¶</div>
                        <div class="detail-value">0/0</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label"><span class="icon-emoji">ğŸ”§</span> ç‰ˆæœ¬</div>
                        <div class="detail-value">æœªçŸ¥ç‰ˆæœ¬</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label"><span class="icon-emoji">ğŸ—ï¸</span> å¹³å°ç±»å‹</div>
                        <div class="detail-value">æœªçŸ¥</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label"><span class="icon-emoji">â±ï¸</span> è¿è¡Œæ—¶é—´</div>
                        <div class="detail-value">æœªçŸ¥</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label"><span class="icon-emoji">ğŸ”¢</span> åè®®å·</div>
                        <div class="detail-value">æœªçŸ¥</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label"><span class="icon-emoji">ğŸŒ</span> æœåŠ¡å™¨åœ°å€</div>
                        <div class="detail-value" style="font-size: 1rem;">${currentAddress}</div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-header">
                        <div class="progress-title"><span class="icon-emoji">ğŸ“ˆ</span> æœåŠ¡å™¨è´Ÿè½½</div>
                        <div class="progress-percentage">0%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-info">
                        <span class="current">0 åœ¨çº¿</span>
                        <span class="max">0 æœ€å¤§</span>
                    </div>
                </div>
            `;
            
            serverInfoContent.innerHTML = serverDetailsHtml;
        }

        // ==================== æ˜¾ç¤ºå‡½æ•° ====================
        function displayResult(data, chinaMin, chinaMax) {
            // æ·»åŠ æ•°å€¼å˜åŒ–åŠ¨ç”»
            onlineCountEl.classList.add('value-change');
            maxCountEl.classList.add('value-change');
            serverVersionEl.classList.add('value-change');
            
            setTimeout(() => {
                onlineCountEl.classList.remove('value-change');
                maxCountEl.classList.remove('value-change');
                serverVersionEl.classList.remove('value-change');
            }, 500);
            
            // æ›´æ–°çŠ¶æ€æ 
            if (data.online) {
                onlineCountEl.textContent = data.players.now;
                maxCountEl.textContent = data.players.max;
                serverVersionEl.textContent = cleanMinecraftText(data.version.name);
                
                onlineCountEl.style.color = '#10b981';
                maxCountEl.style.color = '#3b82f6';
                serverVersionEl.style.color = '#a855f7';
            } else {
                onlineCountEl.textContent = '0';
                maxCountEl.textContent = '0';
                serverVersionEl.textContent = 'ç¦»çº¿';
                
                onlineCountEl.style.color = '#ef4444';
                maxCountEl.style.color = '#ef4444';
                serverVersionEl.style.color = '#ef4444';
            }

            // æ›´æ–°æœåŠ¡å™¨è¯¦æƒ…æ ‡ç­¾é¡µ
            const versionName = cleanMinecraftText(data.version.name || 'æœªçŸ¥ç‰ˆæœ¬');
            const protocol = data.protocol != null && !isNaN(data.protocol) ? data.protocol : 'æœªçŸ¥';
            const platform = 'Java';
            const serverName = data.serverName || currentAddress;
            
            // è®¡ç®—è¿›åº¦æ¡ç™¾åˆ†æ¯”
            const nowPlayers = formatPlayerCount(data.players.now);
            const maxPlayers = formatPlayerCount(data.players.max);
            const progressPercentage = maxPlayers > 0 ? Math.round((nowPlayers / maxPlayers) * 100) : 0;
            
            // æ„å»ºæœåŠ¡å™¨è¯¦æƒ…HTML
            let serverDetailsHtml = '';
            
            if (data.online) {
                // æœåŠ¡å™¨åœ¨çº¿æ—¶æ˜¾ç¤ºæœåŠ¡å™¨å¤´åƒï¼ˆå¤´åƒå°ºå¯¸ç»Ÿä¸€ä¸º120pxï¼‰
                const avatarHtml = data.favicon 
                    ? `<img src="${data.favicon}" alt="æœåŠ¡å™¨å¤´åƒ" class="server-avatar" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\"no-icon\" style=\"width: 120px; height: 120px; font-size: 2rem;\"><span class=\"icon-emoji\">ğŸ®</span></div>` 
                    : '<div class="no-icon" style="width: 120px; height: 120px; font-size: 2rem;"><span class="icon-emoji">ğŸ®</span></div>';
                
                // æ£€æŸ¥æ˜¯å¦æœ‰è¿è¡Œæ—¶é—´ä¿¡æ¯
                const uptimeHtml = data.uptimeText && data.uptimeText !== 'æœªçŸ¥' 
                    ? `<div class="detail-item">
                          <div class="detail-label"><span class="icon-emoji">â±ï¸</span> è¿è¡Œæ—¶é—´</div>
                          <div class="detail-value uptime-value">${data.uptimeText}</div>
                       </div>`
                    : '';
                
                // æ›´æ–°æœåŠ¡å™¨è¯¦æƒ…HTMLï¼Œå°†è¿è¡Œæ—¶é—´æ”¾åœ¨å¹³å°ç±»å‹ä¸‹é¢
                serverDetailsHtml = `
                    <div class="server-details-header">
                        <div class="server-avatar-name-row">
                            <div class="server-avatar-container">
                                ${avatarHtml}
                            </div>
                            <div class="server-name-container">
                                <div class="server-name">${serverName}</div>
                            </div>
                        </div>
                    </div>
                    <div class="server-details-grid">
                        <div class="detail-item">
                            <div class="detail-label"><span class="icon-emoji">ğŸ“Š</span> æœåŠ¡å™¨çŠ¶æ€</div>
                            <div class="detail-value online">åœ¨çº¿</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label"><span class="icon-emoji">ğŸ‘¥</span> å½“å‰/æœ€å¤§ç©å®¶</div>
                            <div class="detail-value">${nowPlayers}/${maxPlayers}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label"><span class="icon-emoji">ğŸ”§</span> ç‰ˆæœ¬</div>
                            <div class="detail-value">${versionName}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label"><span class="icon-emoji">ğŸ—ï¸</span> å¹³å°ç±»å‹</div>
                            <div class="detail-value">${platform}</div>
                        </div>
                        ${uptimeHtml}
                        <div class="detail-item">
                            <div class="detail-label"><span class="icon-emoji">ğŸ”¢</span> åè®®å·</div>
                            <div class="detail-value">${protocol}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label"><span class="icon-emoji">ğŸŒ</span> æœåŠ¡å™¨åœ°å€</div>
                            <div class="detail-value" style="font-size: 1rem;">${currentAddress}</div>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-header">
                            <div class="progress-title"><span class="icon-emoji">ğŸ“ˆ</span> æœåŠ¡å™¨è´Ÿè½½</div>
                            <div class="progress-percentage">${progressPercentage}%</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                        </div>
                        <div class="progress-info">
                            <span class="current">${nowPlayers} åœ¨çº¿</span>
                            <span class="max">${maxPlayers} æœ€å¤§</span>
                        </div>
                    </div>
                `;
            } else {
                // æœåŠ¡å™¨ç¦»çº¿æ—¶ï¼Œè°ƒç”¨displayOfflineResultè€Œä¸æ˜¯åœ¨è¿™é‡Œå¤„ç†
                return;
            }
            
            serverInfoContent.innerHTML = serverDetailsHtml;
        }

        // æ›´æ–°çŠ¶æ€æ å»¶è¿Ÿæ˜¾ç¤º
        function updateStatusPingDisplay() {
            if (avgPing !== null) {
                // æ·»åŠ æ•°å€¼å˜åŒ–åŠ¨ç”»
                avgPingEl.classList.add('value-change');
                setTimeout(() => {
                    avgPingEl.classList.remove('value-change');
                }, 500);
                
                avgPingEl.textContent = `${avgPing}ms`;
                
                // æ ¹æ®å»¶è¿Ÿæ•°å€¼è®¾ç½®é¢œè‰²
                const pingClass = getPingColorClass(avgPing);
                avgPingEl.className = `status-value ${pingClass}`;
            } else {
                avgPingEl.textContent = '--';
                avgPingEl.className = 'status-value';
                avgPingEl.style.color = '#e0e0e0';
            }
        }

        // è·å–pingé¢œè‰²åˆ†ç±»
        function getPingColorClass(ping) {
            if (ping === null) return '';
            if (ping < 100) return 'ping-good';
            if (ping < 200) return 'ping-medium';
            return 'ping-bad';
        }

        // æ˜¾ç¤ºå»¶è¿Ÿå’ŒAPIè¯¦æƒ…ï¼ˆå·²æ·»åŠ å¯æŠ˜å çš„å›½å†…/å›½å¤–APIçŠ¶æ€é¢æ¿ï¼‰
        function displayPingAndApiDetails(results, chinaMin, chinaMax, foreignAvg) {
            let pingApiHtml = '';
            
            // è®¡ç®—æˆåŠŸèŠ‚ç‚¹æ•°é‡
            // æ³¨æ„ï¼šç°åœ¨æœ‰5ä¸ªå›½å†…API
            const domesticSuccessCount = results.filter((r, idx) => idx < 5 && r.success && r.ping !== null && r.data && r.data.online).length;
            const foreignSuccessCount = results.filter((r, idx) => idx >= 5 && idx < 8 && r.success && r.ping !== null && r.data && r.data.online).length;
            const customSuccessCount = results.filter((r, idx) => idx >= 8 && r.success && r.ping !== null && r.data && r.data.online).length;
            const totalSuccessCount = domesticSuccessCount + foreignSuccessCount + customSuccessCount;
            const totalApis = results.length;
            
            if (results.length === 0) {
                pingApiHtml = '<p style="color: #b0b0c0; text-align: center;"><span class="icon-emoji">âš ï¸</span> æ— æ³•è·å–å»¶è¿Ÿå’ŒAPIä¿¡æ¯</p>';
                pingApiContent.innerHTML = pingApiHtml;
                return;
            }
            
            // èŠ‚ç‚¹ç»Ÿè®¡
            pingApiHtml += `
                <div class="node-stats">
                    <div class="node-stat-item">
                        <div class="node-stat-value">${domesticSuccessCount}/5</div>
                        <div class="node-stat-label"><span class="icon-emoji">ğŸ‡¨ğŸ‡³</span> å›½å†…èŠ‚ç‚¹æˆåŠŸ</div>
                    </div>
                    <div class="node-stat-item">
                        <div class="node-stat-value">${foreignSuccessCount}/3</div>
                        <div class="node-stat-label"><span class="icon-emoji">ğŸŒ</span> å›½å¤–èŠ‚ç‚¹æˆåŠŸ</div>
                    </div>
                    <div class="node-stat-item">
                        <div class="node-stat-value">${customSuccessCount}/${customApis.filter(a => a.enabled).length}</div>
                        <div class="node-stat-label"><span class="icon-emoji">ğŸ”§</span> è‡ªå®šä¹‰èŠ‚ç‚¹æˆåŠŸ</div>
                    </div>
                    <div class="node-stat-item">
                        <div class="node-stat-value">${totalSuccessCount}/${totalApis}</div>
                        <div class="node-stat-label"><span class="icon-emoji">ğŸ“Š</span> æ€»æˆåŠŸèŠ‚ç‚¹</div>
                    </div>
                </div>
            `;
            
            // å»¶è¿Ÿæ±‡æ€»éƒ¨åˆ†
            pingApiHtml += `
                <div class="ping-section">
                    <div class="section-title"><span class="icon-emoji">âš¡</span> å»¶è¿Ÿæ±‡æ€»</div>
                    <div class="ping-summary">
            `;
            
            // å›½å†…å»¶è¿Ÿ
            if (chinaMin !== null && chinaMax !== null) {
                pingApiHtml += `
                    <div class="summary-item">
                        <div class="summary-label"><span class="icon-emoji">ğŸ‡¨ğŸ‡³</span> å›½å†…å»¶è¿Ÿ (å¹³å‡)</div>
                        <div class="summary-value ${getPingColorClass(avgPing)}">${avgPing}ms</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label"><span class="icon-emoji">ğŸ“</span> å›½å†…å»¶è¿Ÿ (èŒƒå›´)</div>
                        <div class="summary-value ${getPingColorClass(chinaMin)}">${chinaMin}ms - ${chinaMax}ms</div>
                    </div>
                `;
            } else {
                pingApiHtml += `
                    <div class="summary-item">
                        <div class="summary-label"><span class="icon-emoji">ğŸ‡¨ğŸ‡³</span> å›½å†…å»¶è¿Ÿ</div>
                        <div class="summary-value ping-bad">æ— æ³•è·å–</div>
                    </div>
                `;
            }
            
            // å›½å¤–å»¶è¿Ÿ
            if (foreignAvg !== null) {
                pingApiHtml += `
                    <div class="summary-item">
                        <div class="summary-label"><span class="icon-emoji">ğŸŒ</span> å›½å¤–å»¶è¿Ÿ (å¹³å‡)</div>
                        <div class="summary-value ${getPingColorClass(foreignAvg)}">${foreignAvg}ms</div>
                    </div>
                `;
            } else {
                pingApiHtml += `
                    <div class="summary-item">
                        <div class="summary-label"><span class="icon-emoji">ğŸŒ</span> å›½å¤–å»¶è¿Ÿ</div>
                        <div class="summary-value ping-bad">æ— æ³•è·å–</div>
                    </div>
                `;
            }
            
            pingApiHtml += `
                    </div>
                </div>
            `;
            
            // å›½å†…APIçŠ¶æ€è¯¦æƒ… - å¯æŠ˜å é¢æ¿
            if (domesticSuccessCount > 0 || results.slice(0, 5).some(r => !r.success)) {
                pingApiHtml += `
                    <div class="api-group-panel" id="domestic-api-panel">
                        <div class="api-group-header" data-target="domestic-api-content">
                            <div class="api-group-title-wrapper">
                                <span class="api-group-title"><span class="icon-emoji">ğŸ‡¨ğŸ‡³</span> å›½å†…APIçŠ¶æ€</span>
                                <span class="api-group-stats">${domesticSuccessCount}/5 æˆåŠŸ</span>
                            </div>
                            <div class="collapse-icon domestic-api-arrow">â–¼</div>
                        </div>
                        <div class="api-group-content" id="domestic-api-content">
                            <div class="api-grid">
                `;
                
                // å›½å†…APIçŠ¶æ€è¯¦æƒ…
                results.slice(0, 5).forEach((result, index) => {
                    const regionText = 'å›½å†…';
                    const regionClass = 'domestic';
                    
                    if (result.success && result.data) {
                        const status = result.data.online ? 'online' : 'offline';
                        const statusText = result.data.online ? 'åœ¨çº¿' : 'ç¦»çº¿';
                        const pingText = result.ping !== null ? `${result.ping}ms` : '--';
                        const pingClass = getPingColorClass(result.ping);
                        
                        pingApiHtml += `
                            <div class="api-item" style="animation-delay: ${index * 0.05}s">
                                <div class="api-info">
                                    <span class="api-name"><span class="custom-icon">ğŸŒ</span> ${result.apiName}</span>
                                    <span class="api-region ${regionClass}">${regionText}</span>
                                </div>
                                <div class="api-status">
                                    <div class="status-indicator ${status}" title="${statusText}"></div>
                                    <span class="ping-value ${pingClass}">${pingText}</span>
                                </div>
                            </div>
                        `;
                    } else {
                        pingApiHtml += `
                            <div class="api-item" style="animation-delay: ${index * 0.05}s">
                                <div class="api-info">
                                    <span class="api-name"><span class="custom-icon">ğŸŒ</span> ${result.apiName}</span>
                                    <span class="api-region ${regionClass}">${regionText}</span>
                                </div>
                                <div class="api-status">
                                    <div class="status-indicator error" title="è¯·æ±‚å¤±è´¥"></div>
                                    <span class="ping-value ping-bad">å¤±è´¥</span>
                                </div>
                            </div>
                        `;
                    }
                });
                
                pingApiHtml += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // å›½å¤–APIçŠ¶æ€è¯¦æƒ… - å¯æŠ˜å é¢æ¿
            if (foreignSuccessCount > 0 || results.slice(5, 8).some(r => !r.success)) {
                pingApiHtml += `
                    <div class="api-group-panel" id="foreign-api-panel">
                        <div class="api-group-header" data-target="foreign-api-content">
                            <div class="api-group-title-wrapper">
                                <span class="api-group-title"><span class="icon-emoji">ğŸŒ</span> å›½å¤–APIçŠ¶æ€</span>
                                <span class="api-group-stats">${foreignSuccessCount}/3 æˆåŠŸ</span>
                            </div>
                            <div class="collapse-icon foreign-api-arrow">â–¼</div>
                        </div>
                        <div class="api-group-content" id="foreign-api-content">
                            <div class="api-grid">
                `;
                
                // å›½å¤–APIçŠ¶æ€è¯¦æƒ…
                results.slice(5, 8).forEach((result, index) => {
                    const regionText = 'å›½å¤–';
                    const regionClass = 'foreign';
                    
                    if (result.success && result.data) {
                        const status = result.data.online ? 'online' : 'offline';
                        const statusText = result.data.online ? 'åœ¨çº¿' : 'ç¦»çº¿';
                        const pingText = result.ping !== null ? `${result.ping}ms` : '--';
                        const pingClass = getPingColorClass(result.ping);
                        
                        pingApiHtml += `
                            <div class="api-item" style="animation-delay: ${index * 0.05}s">
                                <div class="api-info">
                                    <span class="api-name"><span class="custom-icon">ğŸŒ</span> ${result.apiName}</span>
                                    <span class="api-region ${regionClass}">${regionText}</span>
                                </div>
                                <div class="api-status">
                                    <div class="status-indicator ${status}" title="${statusText}"></div>
                                    <span class="ping-value ${pingClass}">${pingText}</span>
                                </div>
                            </div>
                        `;
                    } else {
                        pingApiHtml += `
                            <div class="api-item" style="animation-delay: ${index * 0.05}s">
                                <div class="api-info">
                                    <span class="api-name"><span class="custom-icon">ğŸŒ</span> ${result.apiName}</span>
                                    <span class="api-region ${regionClass}">${regionText}</span>
                                </div>
                                <div class="api-status">
                                    <div class="status-indicator error" title="è¯·æ±‚å¤±è´¥"></div>
                                    <span class="ping-value ping-bad">å¤±è´¥</span>
                                </div>
                            </div>
                        `;
                    }
                });
                
                pingApiHtml += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // è‡ªå®šä¹‰APIçŠ¶æ€è¯¦æƒ…
            if (customSuccessCount > 0 || results.slice(8).some(r => !r.success)) {
                pingApiHtml += `
                    <div class="ping-section">
                        <div class="section-title"><span class="icon-emoji">ğŸ”§</span> è‡ªå®šä¹‰APIçŠ¶æ€ (${customSuccessCount}/${customApis.filter(a => a.enabled).length} æˆåŠŸ)</div>
                        <div class="api-grid">
                `;
                
                // è‡ªå®šä¹‰APIçŠ¶æ€è¯¦æƒ…
                results.slice(8).forEach((result, index) => {
                    const regionText = 'è‡ªå®šä¹‰';
                    const regionClass = 'custom';
                    
                    if (result.success && result.data) {
                        const status = result.data.online ? 'online' : 'offline';
                        const statusText = result.data.online ? 'åœ¨çº¿' : 'ç¦»çº¿';
                        const pingText = result.ping !== null ? `${result.ping}ms` : '--';
                        const pingClass = getPingColorClass(result.ping);
                        
                        pingApiHtml += `
                            <div class="api-item" style="animation-delay: ${index * 0.05}s">
                                <div class="api-info">
                                    <span class="api-name"><span class="custom-icon">ğŸ”§</span> ${result.apiName}</span>
                                    <span class="api-region ${regionClass}">${regionText}</span>
                                </div>
                                <div class="api-status">
                                    <div class="status-indicator ${status}" title="${statusText}"></div>
                                    <span class="ping-value ${pingClass}">${pingText}</span>
                                </div>
                            </div>
                        `;
                    } else {
                        pingApiHtml += `
                            <div class="api-item" style="animation-delay: ${index * 0.05}s">
                                <div class="api-info">
                                    <span class="api-name"><span class="custom-icon">ğŸ”§</span> ${result.apiName}</span>
                                    <span class="api-region ${regionClass}">${regionText}</span>
                                </div>
                                <div class="api-status">
                                    <div class="status-indicator error" title="è¯·æ±‚å¤±è´¥"></div>
                                    <span class="ping-value ping-bad">å¤±è´¥</span>
                                </div>
                            </div>
                        `;
                    }
                });
                
                pingApiHtml += `
                        </div>
                    </div>
                `;
            }
            
            pingApiContent.innerHTML = pingApiHtml;
            
            // ä¸ºå¯æŠ˜å é¢æ¿æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            setupCollapsiblePanels();
        }

        // è®¾ç½®å¯æŠ˜å é¢æ¿çš„äº‹ä»¶ç›‘å¬å™¨
        function setupCollapsiblePanels() {
            // å›½å†…APIçŠ¶æ€é¢æ¿
            const domesticHeader = document.querySelector('#domestic-api-panel .api-group-header');
            const domesticContent = document.getElementById('domestic-api-content');
            const domesticArrow = document.querySelector('.domestic-api-arrow');
            
            if (domesticHeader && domesticContent) {
                domesticHeader.addEventListener('click', () => {
                    isDomesticApiExpanded = !isDomesticApiExpanded;
                    
                    if (isDomesticApiExpanded) {
                        domesticContent.classList.add('expanded');
                        domesticArrow.classList.add('expanded');
                    } else {
                        domesticContent.classList.remove('expanded');
                        domesticArrow.classList.remove('expanded');
                    }
                });
                
                // é»˜è®¤ä¸å±•å¼€
                domesticContent.classList.remove('expanded');
                domesticArrow.classList.remove('expanded');
                isDomesticApiExpanded = false;
            }
            
            // å›½å¤–APIçŠ¶æ€é¢æ¿
            const foreignHeader = document.querySelector('#foreign-api-panel .api-group-header');
            const foreignContent = document.getElementById('foreign-api-content');
            const foreignArrow = document.querySelector('.foreign-api-arrow');
            
            if (foreignHeader && foreignContent) {
                foreignHeader.addEventListener('click', () => {
                    isForeignApiExpanded = !isForeignApiExpanded;
                    
                    if (isForeignApiExpanded) {
                        foreignContent.classList.add('expanded');
                        foreignArrow.classList.add('expanded');
                    } else {
                        foreignContent.classList.remove('expanded');
                        foreignArrow.classList.remove('expanded');
                    }
                });
                
                // é»˜è®¤ä¸å±•å¼€
                foreignContent.classList.remove('expanded');
                foreignArrow.classList.remove('expanded');
                isForeignApiExpanded = false;
            }
        }

        // æ˜¾ç¤ºåœ¨çº¿ç©å®¶åˆ—è¡¨ï¼ˆä¿®å¤ï¼šæ·»åŠ å¯¹2b2tç­‰å¤§å‹æœåŠ¡å™¨çš„æ”¯æŒï¼‰
        function displayPlayersList(players, totalOnline = 0) {
            if (!players || players.length === 0) {
                playersContent.innerHTML = '<p class="no-players"><span class="icon-emoji">ğŸ‘€</span> æš‚æ— åœ¨çº¿ç©å®¶</p>';
                playersCountEl.textContent = '0 ä½ç©å®¶';
                return;
            }
            
            // å¦‚æœç©å®¶åˆ—è¡¨æ•°é‡æ˜æ˜¾å°‘äºæ€»åœ¨çº¿äººæ•°ï¼ˆæ¯”å¦‚å°‘äº10%ï¼‰ï¼Œæ˜¾ç¤ºæç¤º
            let showPartialWarning = false;
            if (totalOnline > 0 && players.length < totalOnline && players.length < 50) {
                // åªæ˜¾ç¤ºéƒ¨åˆ†ç©å®¶ï¼Œæ·»åŠ è­¦å‘Šï¼ˆé’ˆå¯¹2b2tç­‰å¤§å‹æœåŠ¡å™¨ï¼‰
                showPartialWarning = true;
            }
            
            playersCountEl.textContent = `${players.length} ä½ç©å®¶${showPartialWarning ? ' (éƒ¨åˆ†)' : ''}`;
            
            let playersHtml = '';
            
            if (showPartialWarning) {
                playersHtml += `
                    <div class="partial-warning">
                        <div class="partial-warning-title">
                            <span style="font-size: 1.2rem; margin-right: 5px;">âš </span> æ³¨æ„
                        </div>
                        <div class="partial-warning-content">
                            ç”±äºæœåŠ¡å™¨åœ¨çº¿ç©å®¶æ•°é‡è¾ƒå¤š (${totalOnline})ï¼Œéƒ¨åˆ†APIåªè¿”å›äº†å‰ ${players.length} ä½ç©å®¶ã€‚å®Œæ•´åˆ—è¡¨å¯èƒ½éœ€è¦ç›´æ¥è¿æ¥æœåŠ¡å™¨æŸ¥çœ‹ã€‚
                        </div>
                    </div>
                `;
            }
            
            playersHtml += '<div class="player-grid">';
            
            players.forEach((player, index) => {
                const playerName = player.name || 'æœªçŸ¥ç©å®¶';
                
                playersHtml += `
                    <div class="player-card" title="${playerName}" style="animation-delay: ${index * 0.05}s">
                        <div class="player-name">${playerName}</div>
                    </div>
                `;
            });
            
            playersHtml += '</div>';
            playersContent.innerHTML = playersHtml;
        }

        // ==================== è‡ªåŠ¨åˆ·æ–°æ§åˆ¶ ====================
        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            
            // ä½¿ç”¨ç”¨æˆ·è®¾ç½®çš„åˆ·æ–°é—´éš”
            const interval = refreshIntervalSeconds * 1000;
            
            refreshInterval = setInterval(() => {
                // åªæœ‰å½“è¾“å…¥æ¡†çš„åœ°å€ä¸å½“å‰æŸ¥è¯¢çš„åœ°å€ç›¸åŒæ—¶æ‰è‡ªåŠ¨åˆ·æ–°
                if (ipInput.value.trim() === currentQueryAddress && !isRequesting) {
                    queryServerStatus(true);
                }
            }, interval);
            
            refreshIndicator.classList.remove('inactive');
            refreshStatus.textContent = `è‡ªåŠ¨åˆ·æ–°å·²å¯ç”¨ (${refreshIntervalSeconds}ç§’)`;
            isAutoRefreshEnabled = true;
        }

        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
                refreshIndicator.classList.add('inactive');
                refreshStatus.textContent = 'è‡ªåŠ¨åˆ·æ–°å·²åœæ­¢';
                isAutoRefreshEnabled = false;
            }
        }
        
        // åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°çŠ¶æ€
        function toggleAutoRefresh() {
            const isChecked = autoRefreshToggle.checked;
            
            // ä¿å­˜å¼€å…³çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem(AUTO_REFRESH_TOGGLE_KEY, isChecked);
            
            if (isChecked) {
                // å¦‚æœå¼€å…³æ‰“å¼€ï¼Œä¸”æœ‰å½“å‰æŸ¥è¯¢åœ°å€ï¼Œåˆ™å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
                if (currentQueryAddress && ipInput.value.trim() === currentQueryAddress) {
                    startAutoRefresh();
                } else {
                    // æ²¡æœ‰æŸ¥è¯¢åœ°å€ï¼Œä»…æ›´æ–°çŠ¶æ€
                    refreshIndicator.classList.remove('inactive');
                    refreshStatus.textContent = `è‡ªåŠ¨åˆ·æ–°å·²å¯ç”¨ (${refreshIntervalSeconds}ç§’)`;
                    isAutoRefreshEnabled = true;
                }
            } else {
                // å¦‚æœå¼€å…³å…³é—­ï¼Œåˆ™åœæ­¢è‡ªåŠ¨åˆ·æ–°
                stopAutoRefresh();
            }
        }
        
        // æ›´æ–°åˆ·æ–°é—´éš”
        function updateRefreshInterval() {
            let newInterval = parseInt(refreshIntervalInput.value);
            
            // éªŒè¯è¾“å…¥å€¼
            if (isNaN(newInterval) || newInterval < 1) {
                newInterval = 5;  // æ”¹ä¸º5ç§’
                refreshIntervalInput.value = 5;
            } else if (newInterval > 60) {
                newInterval = 60;
                refreshIntervalInput.value = 60;
            }
            
            // æ›´æ–°åˆ·æ–°é—´éš”
            refreshIntervalSeconds = newInterval;
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem(REFRESH_INTERVAL_KEY, newInterval.toString());
            
            // å¦‚æœè‡ªåŠ¨åˆ·æ–°æ­£åœ¨è¿è¡Œï¼Œåˆ™é‡å¯è‡ªåŠ¨åˆ·æ–°ä»¥åº”ç”¨æ–°çš„é—´éš”
            if (isAutoRefreshEnabled && autoRefreshToggle.checked && refreshInterval) {
                startAutoRefresh();
            }
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            if (isAutoRefreshEnabled) {
                refreshStatus.textContent = `è‡ªåŠ¨åˆ·æ–°å·²å¯ç”¨ (${refreshIntervalSeconds}ç§’)`;
            }
        }

        // ==================== UIæ§åˆ¶å‡½æ•° ====================
        function disableButtons() {
            queryBtn.disabled = true;
            clearBtn.disabled = true;
            addCustomApiBtn.disabled = true;
        }

        function enableButtons() {
            queryBtn.disabled = false;
            clearBtn.disabled = false;
            addCustomApiBtn.disabled = false;
        }

        function clearResults() {
            // é‡ç½®çŠ¶æ€æ˜¾ç¤º
            onlineCountEl.textContent = '--';
            maxCountEl.textContent = '--';
            serverVersionEl.textContent = '--';
            avgPingEl.textContent = '--';
            
            onlineCountEl.style.color = '#e0e0e0';
            maxCountEl.style.color = '#e0e0e0';
            serverVersionEl.style.color = '#e0e0e0';
            avgPingEl.style.color = '#e0e0e0';
            
            // æ¸…ç©ºå†…å®¹
            serverInfoContent.innerHTML = '<p style="color: #b0b0c0; text-align: center; margin-top: 20px;"><span class="icon-emoji">ğŸ”</span> è¯·å…ˆæŸ¥è¯¢æœåŠ¡å™¨è·å–è¯¦æƒ…</p>';
            pingApiContent.innerHTML = '<p style="color: #b0b0c0; text-align: center; margin-top: 20px;"><span class="icon-emoji">ğŸ“Š</span> è¯·å…ˆæŸ¥è¯¢æœåŠ¡å™¨è·å–å»¶è¿Ÿå’ŒAPIä¿¡æ¯</p>';
            playersContent.innerHTML = '<p class="no-players"><span class="icon-emoji">ğŸ‘€</span> è¯·å…ˆæŸ¥è¯¢æœåŠ¡å™¨è·å–ç©å®¶ä¿¡æ¯</p>';
            playersCountEl.textContent = '0 ä½ç©å®¶';
            playersList = [];
            avgPing = null;
            serverName = '';
            serverIcon = '';
        }

        // ==================== äº‹ä»¶ç›‘å¬å™¨ ====================
        // æ ‡ç­¾é¡µåˆ‡æ¢
        tabBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                tabBtns.forEach(b => b.classList.remove('active'));
                tabContents.forEach(content => content.classList.add('hidden'));
                
                this.classList.add('active');
                const tabId = this.dataset.tab + '-tab';
                document.getElementById(tabId).classList.remove('hidden');
            });
        });

        // æŸ¥è¯¢æŒ‰é’®
        queryBtn.addEventListener('click', () => {
            queryServerStatus(false);
        });

        // æ¸…é™¤åœ°å€æŒ‰é’®
        clearBtn.addEventListener('click', () => {
            ipInput.value = '';
            ipInput.focus();
            stopAutoRefresh();
            clearResults();
        });

        // æ¸…ç©ºå†å²è®°å½•æŒ‰é’®
        clearHistoryBtn.addEventListener('click', () => {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æŸ¥è¯¢å†å²å—ï¼Ÿ')) {
                clearHistory();
            }
        });

        // å›è½¦é”®æŸ¥è¯¢
        ipInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                queryServerStatus(false);
            }
        });

        // ç›‘å¬è¾“å…¥æ¡†å˜åŒ–ï¼Œå½“å†…å®¹å˜åŒ–æ—¶åœæ­¢è‡ªåŠ¨åˆ·æ–°
        ipInput.addEventListener('input', () => {
            // åªæœ‰å½“è¾“å…¥æ¡†å†…å®¹ä¸å½“å‰æŸ¥è¯¢åœ°å€ä¸åŒæ—¶æ‰åœæ­¢åˆ·æ–°
            if (ipInput.value.trim() !== currentQueryAddress) {
                stopAutoRefresh();
                clearResults();
                // æ¸…ç©ºå½“å‰æŸ¥è¯¢åœ°å€
                currentQueryAddress = '';
            }
        });

        // æ™ºèƒ½è§£æç«¯å£å·
        ipInput.addEventListener('blur', function() {
            const ipValue = this.value.trim();
            if (ipValue.includes(':')) {
                const [ip, port] = ipValue.split(':');
                if (port && !isNaN(port) && port >= 1 && port <= 65535) {
                    // ç«¯å£å·²è‡ªåŠ¨è§£æï¼Œæ— éœ€é¢å¤–æ“ä½œ
                }
            }
        });

        // è‡ªåŠ¨åˆ·æ–°å¼€å…³äº‹ä»¶
        autoRefreshToggle.addEventListener('change', () => {
            toggleAutoRefresh();
        });

        // åˆ·æ–°é—´éš”è¾“å…¥æ¡†äº‹ä»¶
        refreshIntervalInput.addEventListener('change', () => {
            updateRefreshInterval();
        });
        
        // è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶ä¹Ÿæ›´æ–°
        refreshIntervalInput.addEventListener('blur', () => {
            updateRefreshInterval();
        });
        
        // æŒ‰å›è½¦é”®æ—¶æ›´æ–°
        refreshIntervalInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                updateRefreshInterval();
            }
        });

        // è‡ªå®šä¹‰APIé¢æ¿æŠ˜å åŠŸèƒ½
        customApiHeader.addEventListener('click', () => {
            toggleCustomApiPanel();
        });

        // æ·»åŠ è‡ªå®šä¹‰APIæŒ‰é’®
        addCustomApiBtn.addEventListener('click', () => {
            const name = customApiNameInput.value;
            const url = customApiUrlInput.value;
            
            if (addCustomApi(name, url)) {
                alert('è‡ªå®šä¹‰APIæ·»åŠ æˆåŠŸï¼');
            }
        });

        // ä¹Ÿå¯ä»¥æŒ‰Enteré”®æ·»åŠ è‡ªå®šä¹‰API
        customApiNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addCustomApiBtn.click();
            }
        });
        
        customApiUrlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addCustomApiBtn.click();
            }
        });

        // ==================== åˆå§‹åŒ– ====================
        window.addEventListener('load', () => {
            renderHistory();
            loadCustomApis();
            
            // åˆå§‹çŠ¶æ€ä¸ºåœæ­¢è‡ªåŠ¨åˆ·æ–°
            refreshIndicator.classList.add('inactive');
            refreshStatus.textContent = 'è‡ªåŠ¨åˆ·æ–°å·²åœæ­¢';
            isAutoRefreshEnabled = false;
            
            // åˆå§‹åŒ–è‡ªå®šä¹‰APIé¢æ¿ä¸ºæŠ˜å çŠ¶æ€
            customApiContent.classList.remove('expanded');
            customApiArrow.classList.remove('expanded');
            isCustomApiExpanded = false;
            
            // ä¿®æ”¹ç‚¹ï¼šé»˜è®¤ä¸åŠ è½½è‡ªåŠ¨åˆ·æ–°å¼€å…³çŠ¶æ€ï¼Œä¿æŒé»˜è®¤å…³é—­
            // æ¸…ç©ºå¯èƒ½å­˜åœ¨çš„è‡ªåŠ¨åˆ·æ–°çŠ¶æ€å­˜å‚¨ï¼Œç¡®ä¿é»˜è®¤å…³é—­
            localStorage.removeItem(AUTO_REFRESH_TOGGLE_KEY);
            autoRefreshToggle.checked = false;
            
            // åŠ è½½åˆ·æ–°é—´éš”è®¾ç½®
            const savedInterval = localStorage.getItem(REFRESH_INTERVAL_KEY);
            if (savedInterval !== null) {
                const interval = parseInt(savedInterval);
                if (!isNaN(interval) && interval >= 1 && interval <= 60) {
                    refreshIntervalSeconds = interval;
                    refreshIntervalInput.value = interval;
                }
            }
        });
    </script>
</body>
</html>